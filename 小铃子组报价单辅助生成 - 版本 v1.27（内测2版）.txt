<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥ä»·å•ç”Ÿæˆç³»ç»Ÿ v1.27 (å†…æµ‹2ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); overflow: hidden; position: relative; }
        
        header { background: linear-gradient(135deg, var(--primary-color), var(--dark-color)); color: white; padding: 30px; text-align: center; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header p { font-size: 1.1rem; opacity: 0.9; }
        
        .main-content { display: flex; min-height: 600px; }
        .sidebar { width: 250px; background: var(--light-color); padding: 25px 28px; border-right: 1px solid #ddd; margin-right: 10px; flex-shrink: 0; }
        .content { flex: 1; padding: 30px 20px; width: 100%; }
        
        .step { margin-bottom: 30px; padding: 20px; border-radius: 8px; background: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .hidden { display: none !important; }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn { display: inline-block; background: var(--secondary-color); color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; text-align: center; margin: 5px; text-decoration: none; }
        .btn:hover { background: #2980b9; transform: translateY(-2px); }
        .btn.selected { background-color: var(--dark-color) !important; border: 2px solid var(--secondary-color); box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.3); transform: scale(1.02); }
        
        .btn-sm { padding: 5px 10px; font-size: 0.85rem; margin: 2px; }
        .btn-large { padding: 15px 30px; font-size: 1.1rem; }
        .btn-success { background: var(--success-color); }
        .btn-success:hover { background: #27ae60; }
        .btn-warning { background: var(--warning-color); }
        .btn-warning:hover { background: #e67e22; }
        .btn-info { background: #17a2b8; }
        .btn-info:hover { background: #138496; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        
        /* è¡¨å•ä¸è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: middle; }
        th { background-color: #f2f2f2; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem; }
        .form-section { margin: 20px 0; padding: 15px; border: 1px solid #e0e0e0; border-radius: 5px; position: relative; }
        .form-section h3 { margin-bottom: 15px; color: var(--dark-color); }
        .calculation-row { background-color: #f8f9fa; }
        .calculation-row td { font-weight: bold; }
        .remove-btn { background: var(--accent-color); color: white; border: none; border-radius: 3px; padding: 4px 8px; cursor: pointer; font-size: 0.8rem; }
        .action-btn { background: #95a5a6; color: white; border: none; border-radius: 3px; padding: 4px 8px; cursor: pointer; font-size: 0.8rem; margin-right: 2px; }
        .action-btn:hover { background: #7f8c8d; }
        
        /* è¿›åº¦æ¡ */
        .step-indicator { display: flex; margin: 20px 0; justify-content: center; }
        .step-item { display: flex; flex-direction: column; align-items: center; flex: 1; position: relative; }
        .step-item:not(:last-child):after { content: ''; position: absolute; top: 20px; right: -50%; width: 100%; height: 2px; background: #ddd; z-index: 1; }
        .step-circle { width: 40px; height: 40px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; z-index: 2; margin-bottom: 10px; }
        .step-item.active .step-circle { background: var(--secondary-color); }
        .step-item.completed .step-circle { background: var(--success-color); }
        
        /* é€‰é¡¹å¡ç‰‡ */
        .option-card { border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; margin: 10px 0; cursor: pointer; transition: all 0.3s ease; }
        .option-card:hover { border-color: var(--secondary-color); transform: translateY(-3px); }
        .option-card h3 { color: var(--primary-color); margin-bottom: 10px; }
        
        /* å›¾ç‰‡ä¸Šä¼ ä¸é¢„è§ˆ */
        .upload-section { display: flex; flex-wrap: wrap; gap: 20px; margin: 15px 0; }
        .upload-item { flex: 1; min-width: 200px; }
        .image-preview { max-width: 200px; max-height: 200px; margin-top: 10px; display: block; }
        .upload-note { font-size: 0.85rem; color: #666; margin-top: 5px; font-style: italic; }
        
        /* æç¤ºæ¡† */
        .alert { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        /* è®¡æ•°å™¨æ ·å¼ */
        .counter-box { background: white; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid var(--secondary-color); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .counter-title { font-weight: bold; color: var(--dark-color); margin-bottom: 5px; font-size: 0.9rem; }
        .counter-number { font-size: 1.5rem; color: var(--secondary-color); font-weight: bold; }
        
        input[readonly] { background-color: #f5f5f5 !important; color: #666 !important; cursor: not-allowed; }
        
        /* æ°´å°æ ·å¼ */
        .watermark-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; display: flex; flex-wrap: wrap; justify-content: center; align-content: center; overflow: hidden; opacity: 0.08; }
        .watermark-text { transform: rotate(-30deg); font-size: 24px; font-weight: bold; color: #000; margin: 50px; white-space: nowrap; user-select: none; }
        
        /* å·¦å³å¸ƒå±€æ ·å¼ */
        .preview-flex-container { display: flex; gap: 20px; align-items: flex-start; }
        .preview-left-pane { width: 40%; border: 1px solid #ddd; padding: 10px; text-align: center; background: #fff; }
        .preview-right-pane { width: 60%; }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 768px) {
            .main-content { flex-direction: column; }
            .sidebar { width: 100%; margin-bottom: 20px; border-right: none; border-bottom: 1px solid #ddd; }
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { position: absolute; top: -9999px; left: -9999px; }
            tr { border: 1px solid #ccc; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); background: white; }
            tr.calculation-row { background: #f8f9fa; border-color: var(--secondary-color); }
            td { border: none; border-bottom: 1px solid #eee; position: relative; padding-left: 40% !important; min-height: 40px; display: flex; align-items: center; }
            td:last-child { border-bottom: none; }
            td:before { position: absolute; top: 50%; left: 10px; transform: translateY(-50%); width: 35%; padding-right: 10px; white-space: nowrap; font-weight: bold; color: #666; content: attr(data-label); font-size: 0.85rem; }
            input, select { font-size: 16px; } 
            .btn-group { justify-content: center; }
            .step-indicator { font-size: 0.8rem; }
            .step-circle { width: 30px; height: 30px; }
            .upload-item { min-width: 100%; margin-bottom: 15px; }
            .preview-flex-container { flex-direction: column; }
            .preview-left-pane, .preview-right-pane { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å°é“ƒå­ç»„-æ ¸ä»·æµç¨‹ç”Ÿæˆç³»ç»Ÿ</h1>
            <p>å¿«é€Ÿåˆ›å»ºTEMUæ ¸ä»·æµç¨‹æ¨¡æ¿</p>
        </header>
        
        <div class="step-indicator">
            <div class="step-item active" id="step1-indicator"><div class="step-circle">1</div><div class="step-title">é€‰æ‹©æ–‡æ¡£</div></div>
            <div class="step-item" id="step2-indicator"><div class="step-circle">2</div><div class="step-title">é€‰æ‹©ç±»å‹</div></div>
            <div class="step-item" id="step3-indicator"><div class="step-circle">3</div><div class="step-title">å¡«å†™ä¿¡æ¯</div></div>
            <div class="step-item" id="step4-indicator"><div class="step-circle">4</div><div class="step-title">é¢„è§ˆå¯¼å‡º</div></div>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <h3>å½“å‰ä¼šè¯ç»Ÿè®¡</h3>
                <div class="counter-box">
                    <div class="counter-title">å¾…å¯¼å‡ºæŠ¥ä»·å•</div>
                    <div id="quote-counter-display" class="counter-number">0</div>
                    <div style="font-size: 0.8rem; color: #999; margin-top: 5px;">
                        éæ¯›ç»‡: <span id="nw-count">0</span> | æ¯›ç»‡: <span id="w-count">0</span>
                    </div>
                </div>
                <div style="margin-top: 15px; font-size: 0.85rem; color: #666; background: #e8f4fd; padding: 10px; border-radius: 5px;">
                    <strong style="color:var(--secondary-color)">ğŸ’¡ æç¤ºï¼š</strong><br>
                    ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æ‚¨çš„è‰ç¨¿ï¼Œåˆ·æ–°é¡µé¢æˆ–æ„å¤–å…³é—­åï¼Œå†…å®¹ä¼šè‡ªåŠ¨æ¢å¤ã€‚
                </div>
                
                <h3 style="margin-top: 20px;">æ”¯æŒåŠŸèƒ½</h3>
                <ul>
                    <li>âœ“ æŠ¥ä»·å•/åŒä»·/æ¶¨ä»·æ¨¡æ¿</li>
                    <li>âœ“ è‡ªåŠ¨æ‹†åˆ†æ‰¹é‡SKC</li>
                    <li>âœ“ æ™ºèƒ½åˆ©æ¶¦å»ºè®®</li>
                    <li>âœ“ <strong>è‡ªåŠ¨ä¿å­˜ä¸æ¢å¤</strong></li>
                    <li>âœ“ <strong>æ°´å°ä¿æŠ¤</strong></li>
                    <li>âœ“ <strong>ç§»åŠ¨ç«¯å¡ç‰‡è§†å›¾</strong></li>
                </ul>
            </div>
            
            <div class="content">
                <div class="step" id="step1">
                    <h2>é€‰æ‹©æ–‡æ¡£ç±»å‹</h2>
                    <div class="option-card" id="quoteOption"><h3>æŠ¥ä»·å•</h3><p>åˆ›å»ºäº§å“æŠ¥ä»·å•ï¼ŒåŒ…å«è¯¦ç»†çš„äº§å“ä¿¡æ¯å’Œè´¹ç”¨æ˜ç»†</p></div>
                    <div class="option-card" id="samePriceOption"><h3>åŒæ¬¾åŒä»·</h3><p>åˆ›å»ºåŒæ¬¾åŒä»·ï¼Œç”¨äºè·Ÿä»·</p></div>
                    <div class="option-card" id="applyIncreaseOption"><h3>ç”³è¯·æ¶¨ä»·</h3><p>åˆ›å»ºç”³è¯·æ¶¨ä»·æ¨¡æ¿ï¼Œç”¨äºè§£å†³è¯¯ç‚¹é—®é¢˜</p></div>
                    <div class="nav-buttons"><div></div><button class="btn btn-large" id="step1-next">ä¸‹ä¸€æ­¥</button></div>
                </div>
                
                <div class="step hidden" id="step2">
                    <h2>é€‰æ‹©æŠ¥ä»·å•ç±»å‹</h2>
                    <div class="btn-group">
                        <button class="btn btn-large" id="woolQuote">æ¯›ç»‡ç±»æŠ¥ä»·å•</button>
                        <button class="btn btn-large" id="nonWoolQuote">éæ¯›ç»‡ç±»æŠ¥ä»·å•</button>
                    </div>
                    <div class="nav-buttons">
                        <button class="btn" id="step2-back">ä¸Šä¸€æ­¥</button>
                        <button class="btn btn-large" id="step2-next">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>

                <div id="smartPasteModal" class="modal hidden" style="margin-bottom: 20px;">
                    <div style="background:#f8f9fa; padding:15px; border-radius:8px; border:1px dashed #ccc;">
                        <h4>ğŸ“ æ™ºèƒ½ç²˜è´´ (æµ‹è¯•ç‰ˆ)</h4>
                        <p style="font-size:0.85rem; color:#666; margin-bottom:5px;">ç²˜è´´å¾®ä¿¡èŠå¤©è®°å½•ï¼Œå°è¯•è‡ªåŠ¨æå–æ¬¾å·å’Œä»·æ ¼</p>
                        <textarea id="smartPasteText" placeholder="ä¾‹å¦‚ï¼šæ¬¾å·8801ï¼Œé¢æ–™å…¨æ£‰ï¼Œä»·æ ¼35å…ƒ..." style="width:100%; height:60px;"></textarea>
                        <div style="text-align:right; margin-top:5px;">
                            <button class="btn btn-sm btn-info" id="btnSmartParse">æå–å¡«å……</button>
                        </div>
                    </div>
                </div>

                <div class="step hidden" id="step3-same-price">
                    <h2>åŒæ¬¾åŒä»·åŠŸèƒ½</h2>
                    <div class="same-price-container" style="display: flex; gap: 30px; margin: 20px 0;">
                        <div class="left-panel" style="flex: 1;">
                            <div class="form-section">
                                <h3>åº—é“ºä¿¡æ¯</h3>
                                <table><tr><td width="30%">åº—é“ºåç§°</td><td width="70%"><input type="text" id="samePriceShopName" placeholder="è¯·è¾“å…¥å¾®ä¿¡ç¾¤å"></td></tr></table>
                            </div>
                            <div class="form-section">
                                <h3>éœ€å¤æ ¸SKC</h3>
                                <textarea id="samePriceTargetSKC" placeholder="å¯æ‰¹é‡å¯¼å…¥ï¼Œæ¯è¡Œä¸€ä¸ªSKC" style="width: 100%; height: 100px;"></textarea>
                                <tr><td>ç³»ç»Ÿå»ºè®®ä»·</td><td><input type="number" id="samePriceSuggestedPrice" placeholder="è¯·è¾“å…¥ç³»ç»Ÿå»ºè®®ä»·" step="0.01"></td></tr>
                            </div>
                            <div class="form-section">
                                <h3>å‚è€ƒä¿¡æ¯</h3>
                                <table>
                                    <tr><td width="30%">å·²æ ¸ä»·SKC</td><td width="70%"><input type="text" id="samePriceReferenceSKC" placeholder="è¯·è¾“å…¥å·²æ ¸ä»·çš„SKC"></td></tr>
                                    <tr><td>ç³»ç»Ÿé€šè¿‡ä»·æ ¼</td><td><input type="number" id="samePriceReferencePrice" placeholder="è¯·è¾“å…¥ç³»ç»Ÿé€šè¿‡ä»·æ ¼" step="0.01"></td></tr>
                                </table>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-warning" id="samePriceReset">é‡å¡«</button>
                                <button class="btn btn-success" id="samePriceAdd">æ·»åŠ </button>
                            </div>
                        </div>
                        <div class="right-panel" style="flex: 1;">
                            <div class="form-section">
                                <h3>é¢„è§ˆåŒºåŸŸ</h3>
                                <div style="overflow-x: auto;">
                                    <table class="bargaining-table" id="samePricePreviewTable">
                                        <thead><tr><th>éœ€è¦åŒä»·SKC</th><th>å·²æ ¸ä»·SKC</th><th>æ ¸ä»·ä»·æ ¼</th><th>æ“ä½œ</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                                <div style="text-align: center; margin-top: 20px;">
                                    <button class="btn btn-large btn-success" id="exportSamePrice">å¯¼å‡ºExcel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="nav-buttons"><button class="btn" id="step3-same-price-back">ä¸Šä¸€æ­¥</button></div>
                </div>
               
                <div class="step hidden" id="step3-apply-increase">
                    <h2>ç”³è¯·æ¶¨ä»·åŠŸèƒ½</h2>
                    <div class="same-price-container">
                        <div class="left-panel">
                            <div class="form-section">
                                <h3>åº—é“ºä¿¡æ¯</h3>
                                <table><tr><td width="30%">åº—é“ºåç§°</td><td width="70%"><input type="text" id="applyIncreaseShopName" placeholder="è¯·è¾“å…¥å¾®ä¿¡ç¾¤å"></td></tr></table>
                            </div>
                            <div class="form-section">
                                <h3>éœ€è¦æ¶¨ä»·çš„SKU</h3>
                                <textarea id="applyIncreaseTargetSKU" placeholder="å¯æ‰¹é‡å¯¼å…¥ï¼Œæ¯è¡Œä¸€ä¸ªSKU" style="width: 100%; height: 100px;"></textarea>
                            </div>
                            <div class="form-section">
                                <h3>ç”³è¯·æ¶¨å›ä»·æ ¼</h3>
                                <table><tr><td width="100%"><input type="number" id="applyIncreasePrice" placeholder="è¯·è¾“å…¥ç”³è¯·æ¶¨å›ä»·æ ¼" step="0.01"></td></tr></table>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-warning" id="applyIncreaseReset">é‡å¡«</button>
                                <button class="btn btn-success" id="applyIncreaseAdd">æ·»åŠ </button>
                            </div>
                        </div>
                        <div class="right-panel">
                            <div class="form-section">
                                <h3>é¢„è§ˆåŒºåŸŸ</h3>
                                <div style="overflow-x: auto;">
                                    <table class="bargaining-table" id="applyIncreasePreviewTable">
                                        <thead><tr><th>éœ€è¦æ¶¨ä»·SKU</th><th>ç”³è¯·æ¶¨å›ä»·æ ¼</th><th>æ“ä½œ</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                                <div style="text-align: center; margin-top: 20px;">
                                    <button class="btn btn-large btn-success" id="exportApplyIncrease">å¯¼å‡ºExcel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="nav-buttons"><button class="btn" id="step3-apply-increase-back">ä¸Šä¸€æ­¥</button></div>
                </div>
               
                <div class="step hidden" id="step3-wool">
                    <h2>æ¯›ç»‡ç±»æŠ¥ä»·å•å¡«å†™</h2>
                    <button class="btn btn-sm btn-info" onclick="toggleSmartPaste()" style="margin-bottom:10px;">ğŸ“‹ å¼€å¯æ™ºèƒ½ç²˜è´´</button>
                    <div class="form-section">
                        <h3>åŸºæœ¬ä¿¡æ¯</h3>
                        <table><tr>
                            <td width="15%">æ¬¾å·</td><td width="35%"><input type="text" id="wool-styleNo" placeholder="è¯·è¾“å…¥æ¬¾å· (æ”¯æŒç©ºæ ¼åˆ†éš”æ‰¹é‡å½•å…¥)"></td>
                            <td width="15%">å•†å®¶æ˜µç§°</td><td width="35%"><input type="text" id="wool-factory" list="supplierHistory" placeholder="è¯·è¾“å…¥æˆ–é€‰æ‹©å•†å®¶æ˜µç§°"></td>
                        </tr></table>
                    </div>
                    <div class="form-section">
                        <h3>çº±çº¿/é¢è¾…æ–™æ˜ç»† <button class="btn btn-sm" id="addYarn" style="float: right;">+ æ·»åŠ </button></h3>
                        <div style="overflow-x: auto;">
                            <table id="yarnTable">
                                <thead><tr><th>çº±çº¿/é¢è¾…æ–™åç§°</th><th width="15%">å•ä½</th><th width="15%">å‡€é‡é‡/ç”¨é‡</th><th width="15%">æŸè€—%</th><th width="15%">å•ä»·/å…¬æ–¤</th><th width="15%">é‡‘é¢</th><th width="15%">æ“ä½œ</th></tr></thead>
                                <tbody><tr>
                                    <td data-label="åç§°"><input type="text" placeholder="çº±çº¿åç§°"></td>
                                    <td data-label="å•ä½"><input type="text" value="å…‹" readonly></td>
                                    <td data-label="é‡é‡"><input type="number" value="0" step="0.01"></td>
                                    <td data-label="æŸè€—"><input type="number" value="0" step="0.01"></td>
                                    <td data-label="å•ä»·"><input type="number" value="0" step="0.01"></td>
                                    <td data-label="é‡‘é¢"><span class="yarn-amount">0.00</span></td>
                                    <td data-label="æ“ä½œ">
                                        <button class="action-btn" onclick="moveRow(this, -1)">â†‘</button>
                                        <button class="action-btn" onclick="moveRow(this, 1)">â†“</button>
                                        <button class="remove-btn" onclick="removeYarnRow(this)">Ã—</button>
                                    </td>
                                </tr></tbody>
                            </table>
                        </div>
                        <div style="text-align: right; margin-top: 10px;"><strong>çº±çº¿å°è®¡ï¼š<span id="yarn-total">0.00</span> å…ƒ</strong></div>
                    </div>
                    <div class="form-section">
                        <h3>ç”Ÿäº§å·¥è‰ºæˆæœ¬</h3>
                        <table>
                            <tr><td width="40%">é’ˆæ•°</td><td width="60%"><input type="text" id="wool-needleCount" placeholder="ä¾‹å¦‚ï¼š12é’ˆ"></td></tr>
                            <tr><td>æ¯åˆ†é’Ÿç»‡æœºå•ä»·(å…ƒ)</td><td><input type="number" id="wool-machinePrice" value="0" step="0.01"></td></tr>
                            <tr><td>ç»‡æœºæ—¶é—´(åˆ†é’Ÿ)</td><td><input type="number" id="wool-machineTime" value="0" step="0.01"></td></tr>
                            <tr class="calculation-row"><td>ç»‡æœºæˆæœ¬(å…ƒ)</td><td><span id="wool-machineCost">0.00</span></td></tr>
                            <tr><td>ç¼æŒ‘(å…ƒ)</td><td><input type="number" id="wool-sewing" value="0" step="0.01"></td></tr>
                            <tr><td>æ´—æ°´(å…ƒ)</td><td><input type="number" id="wool-washing" value="0" step="0.01"></td></tr>
                            <tr><td>åæ•´(å…ƒ)</td><td><input type="number" id="wool-finishing" value="0" step="0.01"></td></tr>
                            <tr><td>è¾…æ–™-æ‰£å­(å…ƒ)</td><td><input type="number" id="wool-button" value="0" step="0.01"></td></tr>
                            <tr><td>è¾…æ–™-æ‹‰é“¾(å…ƒ)</td><td><input type="number" id="wool-zipper" value="0" step="0.01"></td></tr>
                            <tr><td>ä¸“æœº-é’‰æ‰£(å…ƒ)</td><td><input type="number" id="wool-buttonMachine" value="0" step="0.01"></td></tr>
                            <tr><td>ä¸“æœº-å¼€å¹³çœ¼(å…ƒ)</td><td><input type="number" id="wool-eyelet" value="0" step="0.01"></td></tr>
                            <tr><td>å¹³è½¦-ä¸Šæ‹‰é“¾(å…ƒ)</td><td><input type="number" id="wool-zipperSewing" value="0" step="0.01"></td></tr>
                            <tr><td>å…¶ä»–(å…ƒ)</td><td><input type="number" id="wool-other" value="0" step="0.01"></td></tr>
                            <tr><td>è¿è´¹+åŒ…è£…è¾…æ–™(å…ƒ)</td><td><input type="number" id="wool-packing" value="1" step="0.01"></td></tr>
                        </table>
                        <div style="text-align: right; margin-top: 10px;"><strong>å·¥è‰ºæˆæœ¬å°è®¡ï¼š<span id="process-total">0.00</span> å…ƒ</strong></div>
                    </div>
                    <div class="form-section">
                        <h3>æˆæœ¬æ±‡æ€»</h3>
                        <table>
                            <tr class="calculation-row"><td width="70%">æ€»æˆæœ¬</td><td width="30%"><span id="total-cost">0.00</span> å…ƒ</td></tr>
                            <tr><td>åˆ©æ¶¦ç‚¹(%)</td><td><input type="number" id="wool-profitRate" value="30" step="0.01"></td></tr>
                            <tr class="calculation-row"><td>åˆ©æ¶¦é‡‘é¢(å…ƒ)</td><td><span id="profit-amount">0.00</span></td></tr>
                            <tr class="calculation-row"><td><strong>FOBä»·</strong></td><td><strong><span id="fob-price">0.00</span> å…ƒ</strong></td></tr>
                        </table>
                    </div>
                    <div class="form-section">
                        <h3>å›¾ç‰‡ä¸Šä¼ </h3>
                        <div class="upload-section">
                            <div class="upload-item"><h4>æ¬¾å¼å›¾</h4><input type="file" id="wool-styleImage" accept="image/*"><div id="wool-imagePreview" class="image-preview"></div></div>
                            <div class="upload-item"><h4>å”›æ¶å›¾ 1</h4><input type="file" id="wool-markImage" accept="image/*"><div id="wool-markPreview" class="image-preview"></div></div>
                            <div class="upload-item"><h4>å”›æ¶å›¾ 2</h4><input type="file" id="wool-markImage2" accept="image/*"><div id="wool-markPreview2" class="image-preview"></div></div>
                        </div>
                        <div class="upload-section">
                            <div class="upload-item"><h4>è‰²å¡å›¾ 1</h4><input type="file" id="wool-colorCardImage" accept="image/*"><div id="wool-colorCardPreview" class="image-preview"></div></div>
                             <div class="upload-item"><h4>è‰²å¡å›¾ 2</h4><input type="file" id="wool-colorCardImage2" accept="image/*"><div id="wool-colorCardPreview2" class="image-preview"></div></div>
                             <div class="upload-item"></div>
                        </div>
                    </div>
                    <div class="nav-buttons"><button class="btn" id="step3-wool-back">ä¸Šä¸€æ­¥</button><button class="btn btn-large btn-success" id="generateWoolPreview">ç”Ÿæˆé¢„è§ˆ</button></div>
                </div>
                
                <div class="step hidden" id="step3">
                    <h2>éæ¯›ç»‡ç±»æŠ¥ä»·å•å¡«å†™</h2>
                    <button class="btn btn-sm btn-info" onclick="toggleSmartPaste()" style="margin-bottom:10px;">ğŸ“‹ å¼€å¯æ™ºèƒ½ç²˜è´´</button>
                    <div class="form-section">
                        <h3>åŸºæœ¬ä¿¡æ¯</h3>
                        <table><tr>
                            <td width="15%">SKC</td><td width="35%"><input type="text" id="skc" placeholder="è¯·è¾“å…¥SKC (æ”¯æŒç©ºæ ¼åˆ†éš”æ‰¹é‡å½•å…¥)"></td>
                            <td width="15%">å•†å®¶æ˜µç§°</td><td width="35%"><input type="text" id="supplier" list="supplierHistory" placeholder="è¯·è¾“å…¥æˆ–é€‰æ‹©å•†å®¶æ˜µç§°"></td>
                        </tr></table>
                    </div>
                    <div class="form-section">
                        <h3>é¢æ–™æ˜ç»† <button class="btn btn-sm" id="addFabric" style="float: right;">+ æ·»åŠ é¢æ–™</button></h3>
                        <div style="overflow-x: auto;">
                            <table id="fabricTable">
                                <thead><tr><th>åºå·</th><th>ç±»åˆ«</th><th>ææ–™åç§°</th><th>å¹…å®½</th><th>å…‹é‡</th><th>å•ä»·</th><th>å•ä»¶ç”¨é‡</th><th>æŸè€—%</th><th>å•ä»¶å•ä»·</th><th>æ“ä½œ</th></tr></thead>
                                <tbody>
                                    <tr>
                                        <td data-label="åºå·">1</td><td data-label="ç±»åˆ«">é¢æ–™</td>
                                        <td data-label="ææ–™åç§°"><input type="text"></td>
                                        <td data-label="å¹…å®½"><input type="number" step="0.01"></td>
                                        <td data-label="å…‹é‡"><input type="number"></td>
                                        <td data-label="å•ä»·"><input type="number" step="0.01" class="unit-price"></td>
                                        <td data-label="ç”¨é‡"><input type="number" step="0.01" class="usage-per-piece"></td>
                                        <td data-label="æŸè€—"><input type="number" step="0.01" class="loss-rate"></td>
                                        <td data-label="å°è®¡"><input type="number" step="0.01" class="price-per-piece" readonly></td>
                                        <td data-label="æ“ä½œ">
                                            <button class="action-btn" onclick="moveRow(this, -1)">â†‘</button>
                                            <button class="action-btn" onclick="moveRow(this, 1)">â†“</button>
                                            <button class="action-btn" onclick="duplicateRow(this)" title="å¤åˆ¶">â</button>
                                            <button class="remove-btn" onclick="removeFabricRow(this)">Ã—</button>
                                        </td>
                                    </tr>
                                    <tr class="calculation-row"><td colspan="8" style="text-align: right;"><strong>é¢æ–™æ˜ç»†å°è®¡ï¼š</strong></td><td><strong id="fabric-total">0.00</strong></td><td></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>è¾…æ–™æ˜ç»† <button class="btn btn-sm" id="addAccessory" style="float: right;">+ æ·»åŠ è¾…æ–™</button></h3>
                        <div style="overflow-x: auto;">
                            <table id="accessoryTable">
                                <thead><tr><th>åºå·</th><th>ç±»åˆ«</th><th>ææ–™åç§°</th><th>å•ä»¶å•ä»·</th><th>å¤‡æ³¨</th><th>æ“ä½œ</th></tr></thead>
                                <tbody>
                                    <tr>
                                        <td data-label="åºå·">1</td><td data-label="ç±»åˆ«">è¾…æ–™</td>
                                        <td data-label="åç§°"><input type="text"></td>
                                        <td data-label="å•ä»·"><input type="number" value="0" step="0.01"></td>
                                        <td data-label="å¤‡æ³¨"><input type="text"></td>
                                        <td data-label="æ“ä½œ">
                                            <button class="action-btn" onclick="moveRow(this, -1)">â†‘</button>
                                            <button class="action-btn" onclick="moveRow(this, 1)">â†“</button>
                                            <button class="action-btn" onclick="duplicateRow(this)" title="å¤åˆ¶">â</button>
                                            <button class="remove-btn" onclick="removeAccessoryRow(this)">Ã—</button>
                                        </td>
                                    </tr>
                                    <tr class="calculation-row"><td colspan="3" style="text-align: right;"><strong>è¾…æ–™æ˜ç»†å°è®¡ï¼š</strong></td><td><strong id="accessory-total">0.00</strong></td><td colspan="2"></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>å…¶ä»–è´¹ç”¨</h3>
                        <table>
                            <tr><td width="70%">åŠ å·¥è´¹ç”¨</td><td width="30%"><input type="number" id="processingCost" value="0" step="0.01"></td></tr>
                            <tr><td>äºŒæ¬¡å·¥è‰º</td><td><input type="number" id="secondaryProcess" value="0" step="0.01"></td></tr>
                            <tr><td>åŒ…è£…è€—æ</td><td><input type="number" id="packaging" value="1" step="0.01"></td></tr>
                            <tr class="calculation-row"><td><strong>å…¶ä»–è´¹ç”¨å°è®¡ï¼š</strong></td><td><strong id="other-cost-total">1.00</strong></td></tr>
                            <tr> 
                                <td><div style="display: flex; justify-content: space-between; align-items: center;"><span>åˆ©æ¶¦</span><div style="font-size: 0.85rem; color: #666;"><span id="profit-suggestion">å»ºè®®: 0.00å…ƒ</span><button type="button" class="btn btn-warning btn-sm" id="apply-profit-btn" style="margin-left: 5px;">ä¸€é”®åº”ç”¨</button></div></div></td>
                                <td><input type="number" id="profit" value="0" step="0.01"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="form-section">
                        <h3>å›¾ç‰‡ä¸Šä¼ </h3>
                        <div class="upload-section">
                            <div class="upload-item"><h4>æ¬¾å¼å›¾</h4><input type="file" id="styleImage" accept="image/*"><div id="imagePreview" class="image-preview"></div></div>
                            <div class="upload-item"><h4>å”›æ¶å›¾ 1</h4><input type="file" id="markImage" accept="image/*"><div id="markPreview" class="image-preview"></div></div>
                            <div class="upload-item"><h4>å”›æ¶å›¾ 2</h4><input type="file" id="markImage2" accept="image/*"><div id="markPreview2" class="image-preview"></div></div>
                        </div>
                        <div class="upload-section">
                            <div class="upload-item"><h4>è‰²å¡å›¾ 1</h4><input type="file" id="colorCardImage" accept="image/*"><div id="colorCardPreview" class="image-preview"></div></div>
                            <div class="upload-item"><h4>è‰²å¡å›¾ 2</h4><input type="file" id="colorCardImage2" accept="image/*"><div id="colorCardPreview2" class="image-preview"></div></div>
                            <div class="upload-item"></div>
                        </div>
                    </div>
                    <div class="nav-buttons"><button class="btn" id="step3-back">ä¸Šä¸€æ­¥</button><button class="btn btn-large btn-success" id="generatePreview">ç”Ÿæˆé¢„è§ˆ</button></div>
                </div>
                
                <div class="step hidden" id="step4">
                    <h2>æŠ¥ä»·å•é¢„è§ˆ</h2>
                    <p>è¯·æ£€æŸ¥ä»¥ä¸‹æŠ¥ä»·å•å†…å®¹æ˜¯å¦æ­£ç¡®ï¼š</p>
                    <div class="preview-container" id="previewContainer"></div>
                    <div class="nav-buttons"><button class="btn" id="step4-back">ä¸Šä¸€æ­¥</button><button class="btn btn-large btn-success" id="addQuote">ç¡®è®¤æäº¤</button></div>
                </div>
            </div>
        </div>
       
        <footer><p>å°é“ƒå­ç»„æŠ¥ä»·å•ç”Ÿæˆç³»ç»Ÿ - ç‰ˆæœ¬ v1.27 (å†…æµ‹2ç‰ˆ)</p></footer>
        
        <datalist id="supplierHistory"></datalist>
        <div id="submitModal" class="modal hidden">
            <div class="modal-content" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.3); z-index: 1000; min-width: 400px; text-align: center;">
                <h3 style="color: var(--primary-color); margin-bottom: 15px;">æäº¤æˆåŠŸ</h3>
                <p>æŠ¥ä»·å•å·²æˆåŠŸæäº¤ï¼è¡¨å•å·²è‡ªåŠ¨é‡ç½®ã€‚</p>
                
                <div style="margin: 15px 0; background: #f8f9fa; padding: 10px; border-radius: 5px; border: 1px dashed #ccc; text-align: left;">
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">æ±‡æŠ¥æ–‡æ¡ˆï¼š</p>
                    <div id="copyTextContent" style="font-weight: bold; font-size: 0.95rem; color: #2c3e50; word-break: break-all;"></div>
                </div>
                
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-info" id="btnCopyText">å¤åˆ¶æ–‡æ¡ˆ</button>
                    <button class="btn" id="continueSubmit">ç»§ç»­å½•å…¥</button>
                    <button class="btn btn-success" id="exportBargainingBtn">å¯¼å‡ºè®®ä»·è¡¨</button>
                    <button class="btn" id="goToHomeFromSubmit">è¿”å›é¦–é¡µ</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentQuoteType = '';
        let isExporting = false;
        let woolQuotes = [];
        let nonWoolQuotes = [];
        let samePriceData = [];
        let applyIncreaseData = [];
        let supplierHistory = [];
        const imageCache = {
            nonWool: { style: null, mark: null, mark2: null, colorCard: null, colorCard2: null },
            wool: { style: null, mark: null, mark2: null, colorCard: null, colorCard2: null }
        };

        function init() {
            loadHistory();
            bindEventListeners();
            restoreDraft();
            calculateYarnAmount();
            updateWoolTotals();
            updateAllTotals();
            calculateFabricPricePerPiece();
            updateQuoteCounter();
        }
        
        function saveDraft() {
            if(!currentQuoteType) return;
            const draft = {
                type: currentQuoteType,
                data: currentQuoteType==='wool' ? collectWoolFormData() : collectFormData(),
                timestamp: Date.now()
            };
            localStorage.setItem('quote_system_draft', JSON.stringify(draft));
        }
        
        function restoreDraft() {
            const saved = localStorage.getItem('quote_system_draft');
            try {
                const draft = JSON.parse(saved);
            } catch(e) {}
            
            const config = JSON.parse(localStorage.getItem('quote_system_config') || '{}');
            if(config.supplier) {
                document.getElementById('supplier').value = config.supplier;
                document.getElementById('wool-factory').value = config.supplier;
            }
            if(config.profitRate) document.getElementById('wool-profitRate').value = config.profitRate;
            if(config.pkg) document.getElementById('packaging').value = config.pkg;
        }
        
        function saveConfig() {
            const config = {
                supplier: document.getElementById('supplier').value || document.getElementById('wool-factory').value,
                profitRate: document.getElementById('wool-profitRate').value,
                pkg: document.getElementById('packaging').value
            };
            localStorage.setItem('quote_system_config', JSON.stringify(config));
            
            if(config.supplier && !supplierHistory.includes(config.supplier)) {
                supplierHistory.push(config.supplier);
                localStorage.setItem('quote_supplier_history', JSON.stringify(supplierHistory));
                updateHistoryDatalist();
            }
        }
        
        function loadHistory() {
            supplierHistory = JSON.parse(localStorage.getItem('quote_supplier_history') || '[]');
            updateHistoryDatalist();
        }
        
        function updateHistoryDatalist() {
            const dl = document.getElementById('supplierHistory');
            dl.innerHTML = '';
            supplierHistory.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                dl.appendChild(opt);
            });
        }
        
        function clearDraft() {
            localStorage.removeItem('quote_system_draft');
        }
        
        function bindEventListeners() {
            document.body.addEventListener('input', function(e) {
                if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    // saveDraft(); 
                }
            });
            document.getElementById('quoteOption').addEventListener('click', () => document.getElementById('step1-next').click());
            document.getElementById('step1-next').addEventListener('click', goToStep2);
            document.getElementById('samePriceOption').addEventListener('click', () => selectDocumentType('samePrice'));
            document.getElementById('applyIncreaseOption').addEventListener('click', () => selectDocumentType('applyIncrease'));
            document.getElementById('step2-back').addEventListener('click', goBackToStep1);
            document.getElementById('step2-next').addEventListener('click', goToStep3);
            document.getElementById('woolQuote').addEventListener('click', () => selectQuoteType('wool'));
            document.getElementById('nonWoolQuote').addEventListener('click', () => selectQuoteType('nonWool'));
            document.getElementById('step3-back').addEventListener('click', goBackToStep2);
            document.getElementById('step3-wool-back').addEventListener('click', goBackToStep2);
            document.getElementById('step3-same-price-back').addEventListener('click', goBackToStep1FromSamePrice);
            document.getElementById('step3-apply-increase-back').addEventListener('click', goBackToStep1FromApplyIncrease);
            document.getElementById('step4-back').addEventListener('click', goBackToStep3);
            document.getElementById('generatePreview').addEventListener('click', generatePreview);
            document.getElementById('generateWoolPreview').addEventListener('click', generateWoolPreview);
            document.getElementById('addQuote').addEventListener('click', handleSubmit);
            document.getElementById('btnSmartParse').addEventListener('click', runSmartParse);
            document.getElementById('btnCopyText').addEventListener('click', copyReportText);
            
            document.getElementById('addFabric').addEventListener('click', addFabricRow);
            document.getElementById('addAccessory').addEventListener('click', addAccessoryRow);
            document.getElementById('addYarn').addEventListener('click', addYarnRow);
            const bindImg = (id, prev, type, key) => bindImageUpload(id, prev, (d) => imageCache[type][key] = d);
            bindImg('styleImage', 'imagePreview', 'nonWool', 'style');
            bindImg('markImage', 'markPreview', 'nonWool', 'mark');
            bindImg('markImage2', 'markPreview2', 'nonWool', 'mark2');
            bindImg('colorCardImage', 'colorCardPreview', 'nonWool', 'colorCard');
            bindImg('colorCardImage2', 'colorCardPreview2', 'nonWool', 'colorCard2');
            bindImg('wool-styleImage', 'wool-imagePreview', 'wool', 'style');
            bindImg('wool-markImage', 'wool-markPreview', 'wool', 'mark');
            bindImg('wool-markImage2', 'wool-markPreview2', 'wool', 'mark2');
            bindImg('wool-colorCardImage', 'wool-colorCardPreview', 'wool', 'colorCard');
            bindImg('wool-colorCardImage2', 'wool-colorCardPreview2', 'wool', 'colorCard2');
            
            document.getElementById('yarnTable').addEventListener('input', calculateYarnAmount);
            document.querySelectorAll('#step3-wool input').forEach(input => {
                if (input.id && input.id.startsWith('wool-')) input.addEventListener('input', updateWoolTotals);
            });
            document.getElementById('fabricTable').addEventListener('input', function(e) {
                if (e.target.classList.contains('unit-price') || e.target.classList.contains('usage-per-piece') || e.target.classList.contains('loss-rate')) calculateFabricPricePerPiece();
                calculateFabricTotal();
            });
            document.getElementById('accessoryTable').addEventListener('input', calculateAccessoryTotal);
            ['processingCost', 'secondaryProcess', 'packaging', 'profit'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateOtherCostTotal);
            });
            document.getElementById('apply-profit-btn').addEventListener('click', function() {
                const match = document.getElementById('profit-suggestion').textContent.match(/(\d+\.?\d*)/);
                if (match) { document.getElementById('profit').value = match[0]; calculateOtherCostTotal(); }
            });
            document.getElementById('continueSubmit').addEventListener('click', function() {
                document.getElementById('submitModal').classList.add('hidden');
                if (currentQuoteType === 'wool') document.getElementById('step3-wool').classList.remove('hidden');
                else document.getElementById('step3').classList.remove('hidden');
                updateStepIndicator(4, 3);
            });
            document.getElementById('goToHomeFromSubmit').addEventListener('click', function() {
                document.getElementById('submitModal').classList.add('hidden');
                resetToStep1();
            });
            document.getElementById('exportBargainingBtn').addEventListener('click', function() {
                document.getElementById('submitModal').classList.add('hidden');
                exportBargainingTable();
            });
            document.getElementById('samePriceReset').addEventListener('click', resetSamePriceForm);
            document.getElementById('samePriceAdd').addEventListener('click', addSamePriceItem);
            document.getElementById('exportSamePrice').addEventListener('click', exportSamePriceTable);
            document.getElementById('applyIncreaseReset').addEventListener('click', resetApplyIncreaseForm);
            document.getElementById('applyIncreaseAdd').addEventListener('click', addApplyIncreaseItem);
            document.getElementById('exportApplyIncrease').addEventListener('click', exportApplyIncreaseTable);
        }
        
        function toggleSmartPaste() {
            const modal = document.getElementById('smartPasteModal');
            modal.classList.toggle('hidden');
        }
        
        function runSmartParse() {
            const text = document.getElementById('smartPasteText').value;
            const styleMatch = text.match(/(æ¬¾å·|skc|SKC)[:ï¼š\s]*([a-zA-Z0-9\s]+)/i);
            const priceMatch = text.match(/(ä»·æ ¼|ä»·é’±)[:ï¼š\s]*(\d+\.?\d*)/);
            
            let count = 0;
            if (styleMatch) {
                const val = styleMatch[2].trim();
                if(currentQuoteType === 'wool') document.getElementById('wool-styleNo').value = val;
                else document.getElementById('skc').value = val;
                count++;
            }
            if (priceMatch) {
                // ä»·æ ¼ä¸ç›´æ¥å¡«å…¥
            }
            if(count > 0) {
                alert('æå–æˆåŠŸï¼');
                document.getElementById('smartPasteModal').classList.add('hidden');
            } else {
                alert('æœªæå–åˆ°æœ‰æ•ˆä¿¡æ¯ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥');
            }
        }
        
        function copyReportText() {
            const text = document.getElementById('copyTextContent').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('btnCopyText');
                const originalText = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶!';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        }
        
        function moveRow(btn, direction) {
            const row = btn.closest('tr');
            const tbody = row.parentNode;
            const rows = Array.from(tbody.querySelectorAll('tr:not(.calculation-row)'));
            const index = rows.indexOf(row);
            if (direction === -1 && index > 0) {
                tbody.insertBefore(row, rows[index - 1]);
            } else if (direction === 1 && index < rows.length - 1) {
                tbody.insertBefore(row, rows[index + 1].nextSibling);
            }
            
            tbody.querySelectorAll('tr:not(.calculation-row)').forEach((r, i) => {
                if(r.cells[0].getAttribute('data-label') === 'åºå·') r.cells[0].textContent = i + 1;
            });
        }
        
        function duplicateRow(btn) {
            const row = btn.closest('tr');
            const newRow = row.cloneNode(true);
            newRow.querySelectorAll('input').forEach(input => {
                if(input.type === 'number' && !input.classList.contains('unit-price')) {
                }
            });
            row.parentNode.insertBefore(newRow, row.nextSibling);
            calculateFabricTotal();
            calculateAccessoryTotal();
            const tbody = row.parentNode;
            tbody.querySelectorAll('tr:not(.calculation-row)').forEach((r, i) => {
                if(r.cells[0].getAttribute('data-label') === 'åºå·') r.cells[0].textContent = i + 1;
            });
        }
        
        function hideAllSteps() {
            ['step1', 'step2', 'step3', 'step3-wool', 'step3-same-price', 'step3-apply-increase', 'step4'].forEach(id => document.getElementById(id).classList.add('hidden'));
        }
        
        function updateStepIndicator(fromStep, toStep) {
            const indicators = [1,2,3,4].map(i => document.getElementById(`step${i}-indicator`));
            if (currentQuoteType === 'samePrice' || currentQuoteType === 'applyIncrease') {
                if (toStep === 3) { indicators[0].className='step-item completed';
                indicators[1].className='step-item'; indicators[2].className='step-item active'; }
                else if (toStep === 1) { indicators[0].className='step-item active';
                indicators[1].className='step-item'; indicators[2].className='step-item'; }
                return;
            }
            indicators[fromStep-1].classList.remove('active');
            if (fromStep < toStep) indicators[fromStep-1].classList.add('completed');
            else indicators[fromStep-1].classList.remove('completed');
            indicators[toStep-1].classList.add('active');
        }
        
        function updateQuoteCounter() {
            const nw = nonWoolQuotes.length;
            const w = woolQuotes.length;
            document.getElementById('quote-counter-display').textContent = nw + w;
            document.getElementById('nw-count').textContent = nw;
            document.getElementById('w-count').textContent = w;
        }
        
        function selectDocumentType(type) {
            currentQuoteType = type;
            hideAllSteps();
            if (type === 'samePrice') document.getElementById('step3-same-price').classList.remove('hidden');
            else if (type === 'applyIncrease') document.getElementById('step3-apply-increase').classList.remove('hidden');
            if(type !== 'quote') updateStepIndicator(1, 3);
        }
        
        function goToStep2() { hideAllSteps();
            document.getElementById('step2').classList.remove('hidden'); updateStepIndicator(1, 2); }
        function goBackToStep1() { hideAllSteps(); document.getElementById('step1').classList.remove('hidden'); updateStepIndicator(2, 1);
        }
        
        function selectQuoteType(type) {
            currentQuoteType = type;
            document.getElementById('woolQuote').classList.toggle('selected', type === 'wool');
            document.getElementById('nonWoolQuote').classList.toggle('selected', type === 'nonWool');
        }
        
        function goToStep3() {
            if (!currentQuoteType) return alert('è¯·å…ˆé€‰æ‹©æŠ¥ä»·å•ç±»å‹');
            hideAllSteps();
            updateStepIndicator(2, 3);
            if (currentQuoteType === 'wool') document.getElementById('step3-wool').classList.remove('hidden');
            else document.getElementById('step3').classList.remove('hidden');
            restoreDraft();
        }
        
        function goBackToStep2() { hideAllSteps();
            document.getElementById('step2').classList.remove('hidden'); updateStepIndicator(3, 2); document.getElementById('step3-indicator').classList.remove('active'); document.getElementById('step2-indicator').classList.add('active'); }
        
        function goBackToStep3() {
            hideAllSteps();
            updateStepIndicator(4, 3);
            if (currentQuoteType === 'wool') document.getElementById('step3-wool').classList.remove('hidden');
            else document.getElementById('step3').classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        function goBackToStep1FromSamePrice() { hideAllSteps();
            document.getElementById('step1').classList.remove('hidden'); updateStepIndicator(3, 1); }
        function goBackToStep1FromApplyIncrease() { hideAllSteps(); document.getElementById('step1').classList.remove('hidden'); updateStepIndicator(3, 1);
        }
        
        function resetToStep1() {
            hideAllSteps();
            document.getElementById('step1').classList.remove('hidden');
            [1,2,3,4].forEach(i => document.getElementById(`step${i}-indicator`).className = i===1?'step-item active':'step-item');
            woolQuotes = []; nonWoolQuotes = []; samePriceData = []; applyIncreaseData = [];
            currentQuoteType = '';
            updateQuoteCounter();
            imageCache.nonWool = { style: null, mark: null, mark2: null, colorCard: null, colorCard2: null };
            imageCache.wool = { style: null, mark: null, mark2: null, colorCard: null, colorCard2: null };
            clearDraft();
            window.scrollTo(0, 0);
        }
        
        function calculateFabricTotal() {
            let total = 0;
            document.querySelectorAll('#fabricTable tbody tr:not(.calculation-row) .price-per-piece').forEach(i => total += parseFloat(i.value)||0);
            document.getElementById('fabric-total').textContent = total.toFixed(2);
            calculateOtherCostTotal();
        }
        
        function calculateAccessoryTotal() {
            let total = 0;
            document.querySelectorAll('#accessoryTable tbody tr:not(.calculation-row) td:nth-child(4) input').forEach(i => total += parseFloat(i.value)||0);
            document.getElementById('accessory-total').textContent = total.toFixed(2);
            calculateOtherCostTotal();
        }
        
        function calculateOtherCostTotal() {
            const pc = parseFloat(document.getElementById('processingCost').value)||0;
            const sp = parseFloat(document.getElementById('secondaryProcess').value)||0;
            const pkg = parseFloat(document.getElementById('packaging').value)||1;
            const total = pc + sp + pkg;
            document.getElementById('other-cost-total').textContent = total.toFixed(2);
            const fabricTotal = parseFloat(document.getElementById('fabric-total').textContent)||0;
            const accTotal = parseFloat(document.getElementById('accessory-total').textContent)||0;
            document.getElementById('profit-suggestion').textContent = `å»ºè®®: ${((fabricTotal + accTotal + total)*0.30).toFixed(2)}å…ƒ`;
        }
        
        function updateAllTotals() { calculateFabricTotal();
            calculateAccessoryTotal(); calculateOtherCostTotal(); }
        
        function calculateFabricPricePerPiece() {
            document.querySelectorAll('#fabricTable tbody tr:not(.calculation-row)').forEach(row => {
                const u = parseFloat(row.querySelector('.unit-price')?.value)||0, us = parseFloat(row.querySelector('.usage-per-piece')?.value)||0, l = parseFloat(row.querySelector('.loss-rate')?.value)||0;
                const p = row.querySelector('.price-per-piece');
                if(p) p.value = (u * us * (1 + l/100)).toFixed(2);
            });
            calculateFabricTotal();
        }
        
        function calculateYarnAmount() {
            let total = 0;
            document.querySelectorAll('#yarnTable tbody tr').forEach(row => {
                const w = parseFloat(row.cells[2].children[0].value)||0, l = parseFloat(row.cells[3].children[0].value)||0, p = parseFloat(row.cells[4].children[0].value)||0;
                const amt = w * (1 + l/100) * (p/1000);
                row.querySelector('.yarn-amount').textContent = amt.toFixed(2);
                total += amt;
            });
            document.getElementById('yarn-total').textContent = total.toFixed(2);
            updateWoolTotals();
        }
        
        function updateWoolTotals() {
            const yt = parseFloat(document.getElementById('yarn-total').textContent)||0;
            const mp = parseFloat(document.getElementById('wool-machinePrice').value)||0, mt = parseFloat(document.getElementById('wool-machineTime').value)||0;
            const mc = mp * mt;
            document.getElementById('wool-machineCost').textContent = mc.toFixed(2);
            
            const ids = ['sewing','washing','finishing','button','zipper','buttonMachine','eyelet','zipperSewing','other','packing'];
            let pt = mc;
            ids.forEach(id => pt += parseFloat(document.getElementById('wool-'+id).value)||0);
            document.getElementById('process-total').textContent = pt.toFixed(2);
            
            const total = yt + pt;
            document.getElementById('total-cost').textContent = total.toFixed(2);
            const pr = parseFloat(document.getElementById('wool-profitRate').value)||0;
            const pa = total * (pr/100);
            document.getElementById('profit-amount').textContent = pa.toFixed(2);
            document.getElementById('fob-price').textContent = (total+pa).toFixed(2);
        }
        
        function addFabricRow() {
            const tbody = document.querySelector('#fabricTable tbody');
            tbody.querySelector('.calculation-row').remove();
            const idx = tbody.rows.length + 1;
            const row = tbody.insertRow();
            row.innerHTML = `<td data-label="åºå·">${idx}</td><td data-label="ç±»åˆ«">é¢æ–™</td><td data-label="åç§°"><input type="text"></td><td data-label="å¹…å®½"><input type="number" step="0.01"></td><td data-label="å…‹é‡"><input type="number"></td><td data-label="å•ä»·"><input type="number" step="0.01" class="unit-price"></td><td data-label="ç”¨é‡"><input type="number" step="0.01" class="usage-per-piece"></td><td data-label="æŸè€—"><input type="number" step="0.01" class="loss-rate"></td><td data-label="å°è®¡"><input type="number" step="0.01" class="price-per-piece" readonly></td><td data-label="æ“ä½œ"><button class="action-btn" onclick="moveRow(this, -1)">â†‘</button><button class="action-btn" onclick="moveRow(this, 1)">â†“</button><button class="action-btn" onclick="duplicateRow(this)">â</button><button class="remove-btn" onclick="removeFabricRow(this)">Ã—</button></td>`;
            tbody.insertRow().className = 'calculation-row';
            tbody.lastElementChild.innerHTML = `<td colspan="8" style="text-align: right;"><strong>é¢æ–™æ˜ç»†å°è®¡ï¼š</strong></td><td><strong id="fabric-total">0.00</strong></td><td></td>`;
            calculateFabricPricePerPiece();
        }
        
        function removeFabricRow(btn) {
            if(document.querySelectorAll('#fabricTable tbody tr:not(.calculation-row)').length > 1) {
                btn.closest('tr').remove();
                document.querySelectorAll('#fabricTable tbody tr:not(.calculation-row)').forEach((r,i) => r.cells[0].textContent = i+1);
                calculateFabricTotal();
            } else alert('è‡³å°‘ä¿ç•™ä¸€è¡Œ');
        }
        
        function addAccessoryRow() {
            const tbody = document.querySelector('#accessoryTable tbody');
            const row = tbody.insertBefore(document.createElement('tr'), tbody.querySelector('.calculation-row'));
            row.innerHTML = `<td data-label="åºå·">${tbody.rows.length-1}</td><td data-label="ç±»åˆ«">è¾…æ–™</td><td data-label="åç§°"><input type="text"></td><td data-label="å•ä»·"><input type="number" value="0" step="0.01"></td><td data-label="å¤‡æ³¨"><input type="text"></td><td data-label="æ“ä½œ"><button class="action-btn" onclick="moveRow(this, -1)">â†‘</button><button class="action-btn" onclick="moveRow(this, 1)">â†“</button><button class="action-btn" onclick="duplicateRow(this)">â</button><button class="remove-btn" onclick="removeAccessoryRow(this)">Ã—</button></td>`;
            calculateAccessoryTotal();
        }
        
        function removeAccessoryRow(btn) {
            if(document.querySelectorAll('#accessoryTable tbody tr:not(.calculation-row)').length > 1) {
                btn.closest('tr').remove();
                document.querySelectorAll('#accessoryTable tbody tr:not(.calculation-row)').forEach((r,i) => r.cells[0].textContent = i+1);
                calculateAccessoryTotal();
            } else alert('è‡³å°‘ä¿ç•™ä¸€è¡Œ');
        }
        
        function addYarnRow() {
            document.querySelector('#yarnTable tbody').insertRow().innerHTML = `<td data-label="åç§°"><input type="text"></td><td data-label="å•ä½"><input type="text" value="å…‹" readonly></td><td data-label="é‡é‡"><input type="number" value="0"></td><td data-label="æŸè€—"><input type="number" value="0"></td><td data-label="å•ä»·"><input type="number" value="0"></td><td data-label="é‡‘é¢"><span class="yarn-amount">0.00</span></td><td data-label="æ“ä½œ"><button class="action-btn" onclick="moveRow(this, -1)">â†‘</button><button class="action-btn" onclick="moveRow(this, 1)">â†“</button><button class="remove-btn" onclick="removeYarnRow(this)">Ã—</button></td>`;
        }
        
        function removeYarnRow(btn) {
            if(document.querySelectorAll('#yarnTable tbody tr').length > 1) { btn.closest('tr').remove();
            calculateYarnAmount(); } else alert('è‡³å°‘ä¿ç•™ä¸€è¡Œ');
        }
        
        function handleSubmit() {
            const isWool = currentQuoteType === 'wool';
            const validate = isWool ? validateWoolForm : validateNonWoolForm;
            if (!validate()) return showAlert('è¯·å®Œå–„ä¿¡æ¯ï¼', 'error');
            
            saveConfig();
            
            const baseData = isWool ? collectWoolFormData() : collectFormData();
            const targetArr = isWool ? woolQuotes : nonWoolQuotes;
            const splitKey = isWool ? 'styleNo' : 'skc';
            const rawInput = isWool ? document.getElementById('wool-styleNo').value : document.getElementById('skc').value;
            const items = rawInput.split(/\s+/).filter(i => i.trim());
            const price = isWool ? baseData.summary.fobPrice : baseData.summary.total;
            const skcStr = items.length > 0 ? items.join(' ') : (baseData.basicInfo[splitKey]);
            const reportText = `SKCï¼š${skcStr} ç”³è¯·æ ¸ä»· ${price}å…ƒ`;
            document.getElementById('copyTextContent').textContent = reportText;
            
            if (items.length > 0) items.forEach(i => { const n = JSON.parse(JSON.stringify(baseData)); n.basicInfo[splitKey] = i; targetArr.push(n); });
            else targetArr.push(baseData);
            updateQuoteCounter(); 
            resetCurrentForm();
            clearDraft();
            document.getElementById('submitModal').classList.remove('hidden');
        }
        
        function resetCurrentForm() {
            const selector = currentQuoteType === 'wool' ? '#step3-wool' : '#step3';
            document.querySelectorAll(`${selector} input`).forEach(input => {
                if (input.type === 'button' || input.type === 'submit') return;
                if (input.id === 'wool-profitRate' || input.id === 'packaging') return;
                if (input.id === 'wool-packing') { input.value = '1'; return; }
                
                if (!input.readOnly) {
                     if (input.type === 'number') input.value = '0';
                     else if (input.type === 'file') input.value = '';
                     else input.value = '';
                }
            });
            const prevs = currentQuoteType === 'wool' ? ['wool-imagePreview', 'wool-markPreview', 'wool-markPreview2', 'wool-colorCardPreview', 'wool-colorCardPreview2']
                : ['imagePreview', 'markPreview', 'markPreview2', 'colorCardPreview', 'colorCardPreview2'];
            prevs.forEach(id => { const el = document.getElementById(id); if(el) el.innerHTML = ''; });
            if (currentQuoteType === 'wool') imageCache.wool = { style:null, mark:null, mark2:null, colorCard:null, colorCard2:null };
            else imageCache.nonWool = { style:null, mark:null, mark2:null, colorCard:null, colorCard2:null };
            
            const spans = document.querySelectorAll(`${selector} span[id]`);
            spans.forEach(span => {
                 if(span.id !== 'profit-suggestion') span.textContent = '0.00';
            });
            if (currentQuoteType === 'wool') {
                const tbody = document.querySelector('#yarnTable tbody');
                while(tbody.rows.length > 1) tbody.deleteRow(1);
                const inputs = tbody.rows[0].querySelectorAll('input');
                inputs[0].value = ''; 
                for(let i=2;i<=4;i++) inputs[i].value='0';
                calculateYarnAmount();
                updateWoolTotals();
            } else {
                document.getElementById('profit-suggestion').textContent = 'å»ºè®®: 0.00å…ƒ';
                const fBody = document.querySelector('#fabricTable tbody');
                while(fBody.rows.length > 2) fBody.deleteRow(1);
                fBody.rows[0].querySelectorAll('input').forEach(i => i.value = i.type==='number'?'':'');
                
                const aBody = document.querySelector('#accessoryTable tbody');
                while(aBody.rows.length > 2) aBody.deleteRow(1);
                aBody.rows[0].querySelectorAll('input').forEach(i => i.value = i.type==='number'?'0':'');
                
                updateAllTotals();
            }
        }
        
        function validateNonWoolForm() { return !!document.getElementById('skc').value.trim() && !!document.getElementById('supplier').value.trim();
        }
        function validateWoolForm() { return !!document.getElementById('wool-styleNo').value && !!document.getElementById('wool-factory').value;
        }
        
        function collectFormData() {
            const data = { type: 'nonWool', basicInfo: { skc: document.getElementById('skc').value, supplier: document.getElementById('supplier').value }, fabrics: [], accessories: [], otherCosts: { processing: document.getElementById('processingCost').value, secondary: document.getElementById('secondaryProcess').value, packaging: document.getElementById('packaging').value, profit: document.getElementById('profit').value }, styleImage: imageCache.nonWool.style, markImage: imageCache.nonWool.mark, markImage2: imageCache.nonWool.mark2, colorCardImage: imageCache.nonWool.colorCard, colorCardImage2: imageCache.nonWool.colorCard2 };
            document.querySelectorAll('#fabricTable tbody tr:not(.calculation-row)').forEach((row, i) => { const inputs = row.querySelectorAll('input'); if(inputs.length>=7) data.fabrics.push({ serial: i+1, category: 'é¢æ–™', material: inputs[0].value, width: inputs[1].value, weight: inputs[2].value, unitPrice: inputs[3].value, usagePerPiece: inputs[4].value, loss: inputs[5].value, pricePerPiece: inputs[6].value }); });
            document.querySelectorAll('#accessoryTable tbody tr:not(.calculation-row)').forEach((row, i) => { const inputs = row.querySelectorAll('input'); if(inputs.length>=3) data.accessories.push({ serial: data.fabrics.length+i+1, category: 'è¾…æ–™', material: inputs[0].value, pricePerPiece: inputs[1].value, remark: inputs[2].value }); });
            data.summary = { fabricTotal: document.getElementById('fabric-total').textContent, accessoryTotal: document.getElementById('accessory-total').textContent, otherCostsTotal: document.getElementById('other-cost-total').textContent, profit: data.otherCosts.profit, total: (parseFloat(data.summary?.fabricTotal||0) + parseFloat(data.summary?.accessoryTotal||0) + parseFloat(data.summary?.otherCostsTotal||0) + parseFloat(data.otherCosts.profit)).toFixed(2) };
            const ft = parseFloat(document.getElementById('fabric-total').textContent)||0;
            const at = parseFloat(document.getElementById('accessory-total').textContent)||0;
            const ot = parseFloat(document.getElementById('other-cost-total').textContent)||0;
            const p = parseFloat(data.otherCosts.profit)||0;
            data.summary.total = (ft + at + ot + p).toFixed(2);
            return data;
        }
        
        function collectWoolFormData() {
            const yarns = [];
            document.querySelectorAll('#yarnTable tbody tr').forEach(row => { const inputs = row.querySelectorAll('input'); yarns.push({ name: inputs[0].value, unit: inputs[1].value, weight: inputs[2].value, loss: inputs[3].value, price: inputs[4].value, amount: row.querySelector('.yarn-amount').textContent }); });
            return { type: 'wool', basicInfo: { styleNo: document.getElementById('wool-styleNo').value, factory: document.getElementById('wool-factory').value }, yarns: yarns, process: { needleCount: document.getElementById('wool-needleCount').value, machinePrice: document.getElementById('wool-machinePrice').value, machineTime: document.getElementById('wool-machineTime').value, machineCost: document.getElementById('wool-machineCost').textContent, sewing: document.getElementById('wool-sewing').value, washing: document.getElementById('wool-washing').value, finishing: document.getElementById('wool-finishing').value, button: document.getElementById('wool-button').value, zipper: document.getElementById('wool-zipper').value, buttonMachine: document.getElementById('wool-buttonMachine').value, eyelet: document.getElementById('wool-eyelet').value, zipperSewing: document.getElementById('wool-zipperSewing').value, other: document.getElementById('wool-other').value, packing: document.getElementById('wool-packing').value }, summary: { yarnTotal: document.getElementById('yarn-total').textContent, processTotal: document.getElementById('process-total').textContent, totalCost: document.getElementById('total-cost').textContent, profitRate: document.getElementById('wool-profitRate').value, profitAmount: document.getElementById('profit-amount').textContent, fobPrice: document.getElementById('fob-price').textContent }, styleImage: imageCache.wool.style, markImage: imageCache.wool.mark, markImage2: imageCache.wool.mark2, colorCardImage: imageCache.wool.colorCard, colorCardImage2: imageCache.wool.colorCard2 };
        }
        
        function generatePreview(e) { try { if(!validateNonWoolForm()) return;
            const html = generatePreviewHTML(collectFormData()); document.getElementById('previewContainer').innerHTML = html; addWatermarkToPreview(); document.getElementById('step3').classList.add('hidden'); document.getElementById('step4').classList.remove('hidden'); updateStepIndicator(3, 4); window.scrollTo(0,0); } catch(err) { console.error(err); alert('ç”Ÿæˆå¤±è´¥');
        } }
        
        function generateWoolPreview(e) { if(!validateWoolForm()) return;
            const html = generateWoolPreviewHTML(collectWoolFormData());
            document.getElementById('previewContainer').innerHTML = html; addWatermarkToPreview(); document.getElementById('step3-wool').classList.add('hidden'); document.getElementById('step4').classList.remove('hidden'); updateStepIndicator(3, 4); window.scrollTo(0,0);
        }
        
        function addWatermarkToPreview() {
            const container = document.getElementById('previewContainer');
            if(!container.querySelector('.watermark-overlay')) {
                const div = document.createElement('div');
                div.className = 'watermark-overlay';
                let html = '';
                for(let i=0; i<20; i++) html += `<div class="watermark-text">ä»…ä¾›å°é“ƒå­ç»„æ ¸ä»·ä½¿ç”¨</div>`;
                div.innerHTML = html;
                container.appendChild(div);
                container.style.position = 'relative';
            }
        }
        
        function generatePreviewHTML(data) {
            let html = `<h2 style="text-align: center; color: #2c3e50;">éæ¯›ç»‡ç±»æŠ¥ä»·å•é¢„è§ˆ</h2><table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse; margin-bottom: 20px;"><tr><td width="15%"><strong>SKCï¼š</strong></td><td width="35%">${data.basicInfo.skc}</td><td width="15%"><strong>å•†å®¶æ˜µç§°ï¼š</strong></td><td width="35%">${data.basicInfo.supplier}</td></tr></table>`;
            html += `<table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse;"><tr><td colspan="9" style="text-align:center; font-weight: bold; background:#f2f2f2;">é¢è¾…æ–™æ˜ç»†</td></tr><tr><th>åºå·</th><th>ç±»åˆ«</th><th>ææ–™åç§°</th><th>å¹…å®½</th><th>å…‹é‡</th><th>å•ä»·</th><th>å•ä»¶ç”¨é‡</th><th>æŸè€—</th><th>å•ä»¶å•ä»·</th></tr>`;
            data.fabrics.forEach(f => html += `<tr><td>${f.serial}</td><td>é¢æ–™</td><td>${f.material}</td><td>${f.width}</td><td>${f.weight}</td><td>${f.unitPrice}</td><td>${f.usagePerPiece}</td><td>${f.loss}</td><td>${parseFloat(f.pricePerPiece).toFixed(2)}</td></tr>`);
            data.accessories.forEach(a => html += `<tr><td>${a.serial}</td><td>è¾…æ–™</td><td>${a.material}</td><td></td><td></td><td></td><td></td><td></td><td>${parseFloat(a.pricePerPiece).toFixed(2)}</td></tr>`);
            html += `<tr class="calculation-row"><td colspan="8" style="text-align:right;"><strong>é¢è¾…æ–™åˆè®¡ï¼š</strong></td><td><strong>${(parseFloat(data.summary.fabricTotal)+parseFloat(data.summary.accessoryTotal)).toFixed(2)}</strong></td></tr></table>`;
            html += `<div style="display:flex; gap:20px; margin:20px 0;"><div style="flex:1; border:1px solid #ddd; padding:10px; text-align:center;"><strong>æ¬¾å¼å›¾</strong><br>${data.styleImage?`<img src="${data.styleImage}" style="max-width:100%; max-height:300px;">`:'æœªä¸Šä¼ '}</div><div style="flex:1;"><table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse;"><tr><td colspan="3" style="text-align:center; font-weight:bold; background:#f2f2f2;">å…¶ä»–è´¹ç”¨</td></tr><tr><th>åºå·</th><th>é¡¹ç›®</th><th>é‡‘é¢</th></tr><tr><td>1</td><td>åŠ å·¥è´¹ç”¨</td><td>${parseFloat(data.otherCosts.processing).toFixed(2)}</td></tr><tr><td>2</td><td>äºŒæ¬¡å·¥è‰º</td><td>${parseFloat(data.otherCosts.secondary).toFixed(2)}</td></tr><tr><td>3</td><td>åŒ…è£…è€—æ</td><td>${parseFloat(data.otherCosts.packaging).toFixed(2)}</td></tr><tr class="calculation-row"><td colspan="2" style="text-align:right;"><strong>å…¶ä»–è´¹ç”¨åˆè®¡ï¼š</strong></td><td><strong>${data.summary.otherCostsTotal}</strong></td></tr></table><table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse; margin-top:10px;"><tr><td width="80%"><strong>åˆ©æ¶¦</strong></td><td width="20%">${parseFloat(data.otherCosts.profit).toFixed(2)}</td></tr></table></div></div>`;
            html += `<table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse; margin-top:20px;"><tr class="calculation-row" style="background:#e8f4fd; border:2px solid var(--secondary-color);"><td style="text-align:right; font-weight:bold; font-size:1.1rem; color:var(--primary-color);">æ€»åˆè®¡ï¼š<span style="color:#e74c3c; font-size:1.6rem; font-weight:bold; margin:0 5px;">${data.summary.total}</span> å…ƒ</td></tr></table>`;
            return html;
        }
   
        function generateWoolPreviewHTML(data) {
            let html = `
            <h3 style="text-align:center; margin-bottom:15px; color:#2c3e50;">æ¯›ç»‡ç±»æŠ¥ä»·å•é¢„è§ˆ</h3>
            
            <table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse; margin-bottom:15px;">
                <tr>
                    <td width="15%" style="background:#f9f9f9;"><strong>æ¬¾å·</strong></td>
                    <td width="35%">${data.basicInfo.styleNo}</td>
                    <td width="15%" style="background:#f9f9f9;"><strong>å•†å®¶æ˜µç§°</strong></td>
                    <td width="35%">${data.basicInfo.factory}</td>
                </tr>
            </table>
            <table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse; margin-bottom:15px;">
                <tr style="background:#f2f2f2;"><th>çº±çº¿åç§°</th><th>å‡€é‡é‡</th><th>å•ä»·</th><th>æŸè€—</th><th>é‡‘é¢</th></tr>`;
            
            data.yarns.forEach(y => {
                html += `<tr><td>${y.name}</td><td>${y.weight}</td><td>${y.price}</td><td>${y.loss}%</td><td>${y.amount}</td></tr>`;
            });
            
            html += `<tr class="calculation-row"><td colspan="4" style="text-align:right; padding-right:10px;"><strong>çº±çº¿å°è®¡</strong></td><td><strong style="color:var(--primary-color);">${data.summary.yarnTotal}</strong></td></tr>
            </table>`;
            
            html += `<div class="preview-flex-container">`;
            html += `
                <div class="preview-left-pane">
                    <h4 style="margin:0 0 10px 0; color:#555;">æ¬¾å¼å›¾</h4>
                    ${data.styleImage ? `<img src="${data.styleImage}" style="max-width:100%; max-height:400px; border-radius:4px;">` : `<div style="padding:50px; color:#ccc; background:#f9f9f9;">æœªä¸Šä¼ æ¬¾å¼å›¾</div>`}
                </div>`;
            
            html += `
                <div class="preview-right-pane">
                    <table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr><td colspan="2" style="background:#f2f2f2; text-align:center; font-weight:bold;">ç”Ÿäº§å·¥è‰ºæˆæœ¬</td></tr>
                            <tr><th style="background:#fafafa;">é¡¹ç›®</th><th style="background:#fafafa;">é‡‘é¢ (å…ƒ)</th></tr>
                        </thead>
                        <tbody>`;
            
            const p = data.process;
            const machineLabel = `ç»‡æœºæˆæœ¬ <span style="font-size:0.85em; color:#666; font-weight:normal;">(${p.needleCount||'-'} | ${p.machinePrice}/åˆ† | ${p.machineTime}åˆ†)</span>`;
            
            const items = [
                [machineLabel, p.machineCost],
                ['ç¼æŒ‘', p.sewing], ['æ´—æ°´', p.washing], ['åæ•´', p.finishing],
                ['è¾…æ–™-æ‰£å­', p.button], ['è¾…æ–™-æ‹‰é“¾', p.zipper], 
                ['ä¸“æœº-é’‰æ‰£', p.buttonMachine], ['ä¸“æœº-å¼€å¹³çœ¼', p.eyelet], ['å¹³è½¦-ä¸Šæ‹‰é“¾', p.zipperSewing],
                ['å…¶ä»–', p.other], ['è¿è´¹+åŒ…è£…è¾…æ–™', p.packing]
            ];
            
            items.forEach(i => {
                if (parseFloat(i[1]) > 0) {
                    html += `<tr><td>${i[0]}</td><td>${i[1]||'0.00'}</td></tr>`;
                }
            });
            html += `
                        <tr class="calculation-row" style="border-top:2px solid #ddd;">
                            <td style="text-align:right; padding-right:10px;"><strong>å·¥è‰ºæˆæœ¬å°è®¡</strong></td>
                            <td><strong style="color:var(--primary-color);">${data.summary.processTotal}</strong></td>
                        </tr>
                        </tbody>
                    </table>
                     
                    <table border="1" cellspacing="0" cellpadding="5" style="width:100%; border-collapse:collapse; margin-top:15px;">
                        <tr class="calculation-row" style="background:#f8f9fa;">
                            <td width="60%">æ€»æˆæœ¬</td>
                            <td width="40%"><span style="font-size:1.1em;">${data.summary.totalCost}</span></td>
                        </tr>
                        <tr>
                            <td>åˆ©æ¶¦ (${data.summary.profitRate}%)</td>
                            <td>${data.summary.profitAmount}</td>
                        </tr>
                        <tr class="calculation-row" style="background:#e8f4fd; border: 2px solid var(--secondary-color);">
                            <td style="color:var(--primary-color); font-weight:bold;">FOB æŠ¥ä»·</td>
                            <td style="color:#e74c3c; font-size:1.4em; font-weight:bold;">${data.summary.fobPrice}</td>
                        </tr>
                    </table>
                </div>`;
            html += `</div>`; 
            return html;
        }
   
        async function exportBargainingTable() {
            if(isExporting) return showAlert('æ­£åœ¨å¯¼å‡º...','warning');
            const quotes = currentQuoteType === 'wool' ? woolQuotes : nonWoolQuotes;
            if(quotes.length===0) return showAlert('æ— æ•°æ®','error');
            isExporting = true; showAlert('æ­£åœ¨å¯¼å‡º...', 'info');
            try {
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('è®®ä»·è¡¨');
                worksheet.columns = [{ header: 'è´§å“SKC', key: 'sku', width: 15 }, { header: 'ç›®æ ‡ä»·æ ¼', key: 'fobPrice', width: 12 }, { header: 'å¸ç§', key: 'currency', width: 10 }, { header: 'ç”³è¯‰å†…å®¹', key: 'appeal', width: 20 }, { header: 'æŠ¥ä»·å•', key: 'quoteImage', width: 25 }, { header: 'å”›æ¶å›¾1', key: 'markImage', width: 25 }, { 
                header: 'å”›æ¶å›¾2', key: 'markImage2', width: 25 }, { header: 'è‰²å¡å›¾1', key: 'colorCardImage', width: 25 }, { header: 'è‰²å¡å›¾2', key: 'colorCardImage2', width: 25 }, { header: 'ç³»ç»Ÿä»·æ ¼', key: 'systemPrice', width: 12 }, { header: 'ä¹°æ‰‹èŠ±å', key: 'buyerName', width: 15 }];
                styleWorksheetHeader(worksheet);
                
                let combinedReport = "";
                for(let i=0; i<quotes.length; i++) {
                    const q = quotes[i];
                    let imgData; try { imgData = await generateQuotePreviewImage(q); } catch(e) { imgData = q.styleImage; }
                    const appeal = q.type==='wool' ? `çº±çº¿${q.summary.yarnTotal}+å·¥è‰º${q.summary.processTotal}+åˆ©æ¶¦${q.summary.profitAmount}=${q.summary.fobPrice}` : `é¢æ–™${q.summary.fabricTotal}+è¾…æ–™${q.summary.accessoryTotal}+å…¶ä»–${q.summary.otherCostsTotal}+åˆ©æ¶¦${q.summary.profit}=${q.summary.total}`;
                    const row = worksheet.addRow({ sku: q.basicInfo.styleNo||q.basicInfo.skc, fobPrice: q.type==='wool'?q.summary.fobPrice:q.summary.total, currency: 'äººæ°‘å¸', appeal: appeal, systemPrice:'', buyerName:'å°é“ƒå­' });
                    row.height = 120;
                    const r = row.number;
                    await Promise.all([addImageToCell(workbook, worksheet, imgData, 'E'+r), addImageToCell(workbook, worksheet, q.markImage, 'F'+r), addImageToCell(workbook, worksheet, q.markImage2, 'G'+r), addImageToCell(workbook, worksheet, q.colorCardImage, 'H'+r), addImageToCell(workbook, worksheet, q.colorCardImage2, 'I'+r)]);
                    ['A','B','C','D','J','K'].forEach(c => worksheet.getCell(c+r).alignment={vertical:'middle',horizontal:'center'});
                    
                    const price = q.type === 'wool' ? q.summary.fobPrice : q.summary.total;
                    const skc = q.basicInfo.styleNo || q.basicInfo.skc;
                    combinedReport += `SKCï¼š${skc} ç”³è¯·æ ¸ä»· ${price}å…ƒ\n`;
                }
                const name = quotes[0]?.basicInfo?.factory || quotes[0]?.basicInfo?.supplier || 'å•†å®¶';
                await downloadWorkbook(workbook, `è®®ä»·è¡¨-${name}-${getTodayDate()}.xlsx`);
                
                showExportSuccessModal(combinedReport);
            } catch(e) { console.error(e); showAlert('å¯¼å‡ºå¤±è´¥:'+e.message,'error'); } finally { isExporting = false;
            }
        }
        
        function showAlert(msg, type) { const div = document.createElement('div');
        div.className = `alert alert-${type}`; div.textContent = msg; document.querySelector('.content').insertBefore(div, document.querySelector('.step')); setTimeout(() => div.remove(), 3000);
        }
        function getTodayDate() { return new Date().toISOString().slice(0, 10);
        }
        function styleWorksheetHeader(ws) { ws.getRow(1).font={bold:true}; ws.getRow(1).alignment={vertical:'middle',horizontal:'center'};
        }
        async function downloadWorkbook(wb, name) { saveAs(new Blob([await wb.xlsx.writeBuffer()]), name);
        }
        
        function showExportSuccessModal(reportText) { 
            const div = document.createElement('div');
            const textHtml = reportText ? `
                <div style="margin:15px 0; text-align:left; background:#f8f9fa; padding:15px; border-radius:8px; border:1px solid #eee;">
                    <p style="margin-bottom:8px; color:#2c3e50; font-weight:bold; font-size:14px;">ğŸ“‹ æ±‡æŠ¥æ–‡æ¡ˆæ±‡æ€»</p>
                    <textarea id="finalReportArea" readonly style="width:100%; height:80px; border:1px solid #ddd; font-size:13px; padding:8px; background-color:#f5f5f5; color:#555; resize:none; border-radius:4px; outline:none; cursor:default;">${reportText}</textarea>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
                        <span style="font-size:12px; color:#95a5a6;">â„¹ï¸ å¤åˆ¶åˆ°æ ¸ä»·ç¾¤ï¼Œä¸æ–‡ä»¶ä¸€èµ·å‘é€ï¼Œæ–¹ä¾¿ä¹°æ‰‹å¤„ç†</span>
                        <button class="btn btn-sm btn-info" onclick="copyFromTextarea('finalReportArea', this)">ä¸€é”®å¤åˆ¶</button>
                    </div>
                </div>` : '';
                
            div.innerHTML = `<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:2000;display:flex;align-items:center;justify-content:center;"><div style="background:white;padding:30px;border-radius:10px;text-align:center;min-width:400px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);"><h3>å¯¼å‡ºæˆåŠŸ</h3>${textHtml}<div style="margin-top:20px;"><button class="btn btn-success" onclick="this.parentElement.parentElement.parentElement.parentElement.remove();resetToStep1()">è¿”å›é¦–é¡µ</button></div></div></div>`;
            document.body.appendChild(div); 
        }
        function copyFromTextarea(id, btn) {
            const el = document.getElementById(id);
            if(!el) return;
            el.select();
            el.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(el.value).then(() => {
                const original = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶!';
                btn.className = 'btn btn-sm btn-success';
                setTimeout(() => {
                  btn.textContent = original;
                    btn.className = 'btn btn-sm btn-info';
                }, 2000);
            }).catch(() => alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'));
        }
        
        async function addImageToCell(wb, ws, data, addr) { if(!data) return;
        try { const id = wb.addImage({ base64: data.split(',')[1], extension: 'png' });
        ws.addImage(id, { tl: { col: ws.getCell(addr).col-1, row: ws.getCell(addr).row-1 }, ext: { width: 100, height: 100 } });
        } catch(e){} }
        
        async function generateQuotePreviewImage(q) { return new Promise((res, rej) => { 
            const div = document.createElement('div'); 
            Object.assign(div.style, {position:'fixed',left:'-9999px',background:'white',padding:'20px'}); 
            div.innerHTML = q.type==='wool'?generateWoolPreviewHTML(q):generatePreviewHTML(q); 
            const wm = document.createElement('div'); wm.className='watermark-overlay';
            for(let i=0;i<10;i++) wm.innerHTML += `<div class="watermark-text" style="font-size:18px;">ä»…ä¾›å°é“ƒå­ç»„æ ¸ä»·ä½¿ç”¨</div>`;
            div.style.position='relative'; div.appendChild(wm);
            document.body.appendChild(div); 
            html2canvas(div, {scale:1.5, useCORS:true}).then(c => { document.body.removeChild(div); res(c.toDataURL()); }).catch(e => { document.body.removeChild(div); rej(e); }); 
        });
        }
        
        function bindImageUpload(id, prevId, cb) { document.getElementById(id).addEventListener('change', function(e) { const f = e.target.files[0]; const p = document.getElementById(prevId); p.innerHTML = ''; if(f && f.type.startsWith('image/')) { const r = new FileReader(); r.onload = (v) => { const img = document.createElement('img'); img.src = v.target.result; img.className = 'image-preview'; p.appendChild(img); cb(v.target.result); }; r.readAsDataURL(f); } else { e.target.value=''; cb(null); } });
        }

        /* --- æ ¸å¿ƒé€»è¾‘ --- */

        function addSamePriceItem() {
            const shopName = document.getElementById('samePriceShopName').value.trim();
            const targetSkcText = document.getElementById('samePriceTargetSKC').value.trim();
            const refSkc = document.getElementById('samePriceReferenceSKC').value.trim();
            const refPrice = document.getElementById('samePriceReferencePrice').value.trim();
            const suggestPrice = document.getElementById('samePriceSuggestedPrice').value.trim();

            if (!shopName || !targetSkcText || !refSkc || !refPrice) {
                return showAlert('è¯·å¡«å†™å®Œæ•´åº—é“ºåã€éœ€å¤æ ¸SKCã€å·²æ ¸ä»·SKCå’Œé€šè¿‡ä»·æ ¼', 'error');
            }

            const targets = targetSkcText.split(/[\n\s]+/).filter(item => item.trim() !== '');
            if (targets.length === 0) return showAlert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªéœ€å¤æ ¸SKC', 'error');

            targets.forEach(target => {
                samePriceData.push({
                    shopName: shopName,
                    targetSkc: target,
                    refSkc: refSkc,
                    refPrice: refPrice,
                    suggestPrice: suggestPrice || ''
                });
            });

            document.getElementById('samePriceTargetSKC').value = '';
            updateSamePricePreview();
            showAlert(`æˆåŠŸæ·»åŠ  ${targets.length} æ¡è®°å½•`, 'success');
        }

        function updateSamePricePreview() {
            const tbody = document.querySelector('#samePricePreviewTable tbody');
            tbody.innerHTML = '';
            samePriceData.forEach((item, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `<td>${item.targetSkc}</td><td>${item.refSkc}</td><td>${item.refPrice}</td><td><button class="remove-btn" onclick="removeSamePriceItem(${index})">åˆ é™¤</button></td>`;
            });
        }

        function removeSamePriceItem(index) {
            samePriceData.splice(index, 1);
            updateSamePricePreview();
        }

        async function exportSamePriceTable() {
            if (samePriceData.length === 0) return showAlert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'error');
            if (isExporting) return;

            try {
                isExporting = true;
                showAlert('æ­£åœ¨å¯¼å‡ºåŒæ¬¾åŒä»·è¡¨...', 'info');

                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('åŒæ¬¾åŒä»·');

                // è®¾ç½®è¡¨å¤´
                worksheet.columns = [
                    { header: 'éœ€ç”³è¯·skc', key: 'target', width: 25 },       // aåˆ—
                    { header: 'ç›®æ ‡ä»·æ ¼', key: 'price', width: 12 },        // båˆ—
                    { header: 'äººæ°‘å¸/ç¾å…ƒ', key: 'currency', width: 12 },   // cåˆ—
                    { header: 'ä¹°æ‰‹ç”³è¯‰å†…å®¹', key: 'appeal', width: 60 }     // dåˆ—
                ];

                styleWorksheetHeader(worksheet);

                // åˆ†ç»„é€»è¾‘
                const groups = {};
                samePriceData.forEach(item => {
                    // ç”Ÿæˆåˆ†ç»„é”®å€¼ï¼šå·²æ ¸ä»·SKC_ä»·æ ¼
                    const key = `${item.refSkc}_${item.refPrice}`;
                    if (!groups[key]) groups[key] = [];
                    groups[key].push(item);
                });

                let currentRowIndex = 2; // Excelè¡Œå·ä»1å¼€å§‹ï¼Œç¬¬1è¡Œæ˜¯è¡¨å¤´

                // éå†æ¯ä¸ªåˆ†ç»„è¿›è¡Œå†™å…¥
                for (const key in groups) {
                    const groupItems = groups[key];
                    const firstItem = groupItems[0];
                    const startRow = currentRowIndex;
                    
                    // æå–è¯¥ç»„æ‰€æœ‰"éœ€ç”³è¯·SKC"ï¼Œç”¨ç©ºæ ¼è¿æ¥
                    const allTargets = groupItems.map(i => i.targetSkc).join(' ');
                    
                    // æ ¼å¼åŒ–ç”³è¯‰æ–‡æ¡ˆ
                    const appealText = `skc:${allTargets}ï¼Œç³»ç»Ÿå»ºè®®ä»·${firstItem.suggestPrice || '0'}å…ƒï¼ŒåŒæ¬¾åŒé¢æ–™/å¤è‰²skc:${firstItem.refSkc}ï¼Œä»·æ ¼${firstItem.refPrice}å…ƒï¼Œç”³è¯·åŒæ¬¾åŒä»·${firstItem.refPrice}å…ƒ`;

                    // å†™å…¥è¯¥ç»„çš„æ‰€æœ‰è¡Œ
                    groupItems.forEach(item => {
                        worksheet.addRow({
                            target: item.targetSkc,
                            price: parseFloat(item.refPrice),
                            currency: 'äººæ°‘å¸',
                            appeal: appealText
                        });
                        currentRowIndex++;
                    });

                    const endRow = currentRowIndex - 1;

                    // åˆå¹¶ D åˆ— (ç”³è¯‰å†…å®¹)
                    if (endRow > startRow) {
                        worksheet.mergeCells(`D${startRow}:D${endRow}`);
                    }
                    
                    // è®¾ç½® D åˆ—æ ·å¼ï¼šå‚ç›´å±…ä¸­ã€å·¦å¯¹é½ã€è‡ªåŠ¨æ¢è¡Œ
                    const cell = worksheet.getCell(`D${startRow}`);
                    cell.alignment = { vertical: 'middle', horizontal: 'left', wrapText: true };
                }

                // æ–‡ä»¶åæ ¼å¼ (ç”³è¯·åŒæ¬¾åŒä»·-åº—é“º-æ—¥æœŸ)
                const shopName = samePriceData[0].shopName || 'åº—é“º';
                const fileName = `ç”³è¯·åŒæ¬¾åŒä»·-${shopName}-${getTodayDate()}.xlsx`;

                await downloadWorkbook(workbook, fileName);
                showAlert('å¯¼å‡ºæˆåŠŸ', 'success');

            } catch (e) {
                console.error(e);
                showAlert('å¯¼å‡ºå¤±è´¥: ' + e.message, 'error');
            } finally {
                isExporting = false;
            }
        }

        function resetSamePriceForm() { document.getElementById('samePriceShopName').value=''; document.getElementById('samePriceTargetSKC').value=''; document.getElementById('samePriceReferenceSKC').value=''; document.getElementById('samePriceReferencePrice').value=''; document.getElementById('samePriceSuggestedPrice').value=''; samePriceData=[]; updateSamePricePreview(); }

        function resetApplyIncreaseForm() {
            document.getElementById('applyIncreaseShopName').value = '';
            document.getElementById('applyIncreaseTargetSKU').value = '';
            document.getElementById('applyIncreasePrice').value = '';
            applyIncreaseData = [];
            updateApplyIncreasePreview();
        }

        function addApplyIncreaseItem() {
            const shopName = document.getElementById('applyIncreaseShopName').value.trim();
            const targetSkuText = document.getElementById('applyIncreaseTargetSKU').value.trim();
            const price = document.getElementById('applyIncreasePrice').value.trim();
            if (!shopName || !targetSkuText || !price) {
                return showAlert('è¯·å¡«å†™å®Œæ•´åº—é“ºåã€SKUå’Œç”³è¯·ä»·æ ¼', 'error');
            }
            const targets = targetSkuText.split(/[\n\s]+/).filter(item => item.trim() !== '');
            if (targets.length === 0) return showAlert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªSKU', 'error');
            targets.forEach(target => {
                applyIncreaseData.push({ shopName: shopName, targetSku: target, price: price });
            });
            document.getElementById('applyIncreaseTargetSKU').value = '';
            updateApplyIncreasePreview();
            showAlert(`æˆåŠŸæ·»åŠ  ${targets.length} æ¡è®°å½•`, 'success');
        }

        function updateApplyIncreasePreview() {
            const tbody = document.querySelector('#applyIncreasePreviewTable tbody');
            tbody.innerHTML = '';
            applyIncreaseData.forEach((item, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `<td>${item.targetSku}</td><td>${item.price}</td><td><button class="remove-btn" onclick="removeApplyIncreaseItem(${index})">åˆ é™¤</button></td>`;
            });
        }

        function removeApplyIncreaseItem(index) {
            applyIncreaseData.splice(index, 1);
            updateApplyIncreasePreview();
        }

        async function exportApplyIncreaseTable() {
            if (applyIncreaseData.length === 0) return showAlert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'error');
            if (isExporting) return;
            try {
                isExporting = true;
                showAlert('æ­£åœ¨å¯¼å‡ºç”³è¯·æ¶¨ä»·è¡¨...', 'info');
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('ç”³è¯·æ¶¨ä»·');
                worksheet.columns = [{ header: 'åº—é“ºåç§°', key: 'shop', width: 20 }, { header: 'éœ€è¦æ¶¨ä»·SKU', key: 'sku', width: 25 }, { header: 'ç”³è¯·æ¶¨å›ä»·æ ¼', key: 'price', width: 15 }];
                styleWorksheetHeader(worksheet);
                applyIncreaseData.forEach(data => {
                    worksheet.addRow({ shop: data.shopName, sku: data.targetSku, price: parseFloat(data.price) });
                });
                await downloadWorkbook(workbook, `ç”³è¯·æ¶¨ä»·è¡¨-${getTodayDate()}.xlsx`);
                showAlert('å¯¼å‡ºæˆåŠŸ', 'success');
            } catch (e) { console.error(e); showAlert('å¯¼å‡ºå¤±è´¥: ' + e.message, 'error'); } finally { isExporting = false; }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>


