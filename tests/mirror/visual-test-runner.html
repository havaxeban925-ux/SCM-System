<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCMç³»ç»Ÿæµç¨‹å›¾å¯è§†åŒ–æµ‹è¯•è¿è¡Œå™¨</title>
    <link rel="stylesheet" href="visual-test-runner.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
        }
        #root {
            min-height: 100vh;
        }
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            gap: 20px;
        }
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e2e8f0;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-text {
            color: #64748b;
            font-size: 14px;
        }
        .error-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            gap: 16px;
            padding: 20px;
            text-align: center;
        }
        .error-icon {
            font-size: 64px;
        }
        .error-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e293b;
        }
        .error-message {
            color: #64748b;
            max-width: 500px;
            line-height: 1.6;
        }
        .error-details {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            max-width: 600px;
            text-align: left;
        }
        .error-details h4 {
            color: #ef4444;
            margin-bottom: 12px;
        }
        .error-details code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">æ­£åœ¨åŠ è½½æµ‹è¯•è¿è¡Œå™¨...</div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        // ç±»å‹å®šä¹‰
        const moduleConfigs = {
            'Pricing': { name: 'æ ¸ä»·ç”³è¯·', color: '#3b82f6', icon: 'ğŸ’°', description: 'å•†å®¶å‘ä¹°æ‰‹æäº¤ä»·æ ¼å®¡æ ¸ç”³è¯·' },
            'Anomaly': { name: 'å¼‚å¸¸ç”³è¯·', color: '#ef4444', icon: 'âš ï¸', description: 'å¤„ç†å•†å“å¼‚å¸¸æƒ…å†µ' },
            'PrivatePush': { name: 'ç§æ¨æ¥æ¬¾', color: '#8b5cf6', icon: 'ğŸ“±', description: 'å•†å®¶æ¥æ”¶ä¹°æ‰‹ç§æ¨æ¬¾å¼' },
            'PublicPool': { name: 'å…¬æ± æ¥æ¬¾', color: '#06b6d4', icon: 'ğŸŒ', description: 'å•†å®¶ä»å…¬æ± ç«äº‰è·å–æ¬¾å¼' },
            'Order': { name: 'æ¥å•ç¡®è®¤', color: '#f59e0b', icon: 'ğŸ“‹', description: 'å•†å®¶ç¡®è®¤å¹¶å¤„ç†è®¢å•' },
            'Logistics': { name: 'å‘è´§ç‰©æµ', color: '#10b981', icon: 'ğŸšš', description: 'å‘è´§å’Œç‰©æµè·Ÿè¸ªç®¡ç†' },
            'Development': { name: 'å¼€å‘è¿›åº¦', color: '#ec4899', icon: 'ğŸ“ˆ', description: 'æ¬¾å¼å¼€å‘è¿›åº¦è·Ÿè¸ª' },
            'Dashboard': { name: 'ç³»ç»Ÿé©¾é©¶èˆ±', color: '#6366f1', icon: 'ğŸ¯', description: 'ä¹°æ‰‹æ•°æ®ç»Ÿè®¡å’Œé©¾é©¶èˆ±å±•ç¤º' },
            'StyleCreate': { name: 'ç§æ¨åˆ›å»º', color: '#14b8a6', icon: 'âœ¨', description: 'ä¹°æ‰‹åˆ›å»ºç§æ¨æ¬¾å¼' },
            'PublicPush': { name: 'å…¬æ± æ¨é€', color: '#f97316', icon: 'ğŸš€', description: 'ä¹°æ‰‹æ¨é€æ¬¾å¼åˆ°å…¬æ± ' }
        };
        
        // æµ‹è¯•å¥—ä»¶æ•°æ®ï¼ˆå†…åµŒé¿å…æ¨¡å—åŠ è½½é—®é¢˜ï¼‰
        const testSuites = [
            {
                flowchartName: '2.2.2 æ ¸ä»·ç”³è¯·è¯¦ç»†æµç¨‹',
                flowchartId: 'PRICING_FLOW',
                testCases: [
                    { module: 'Pricing', testName: 'æ ¸ä»·ç”³è¯·-é€‰æ‹©æ ¸ä»·ç±»å‹', apiEndpoint: '/requests/quote', method: 'POST', requestBody: { subType: 'åŒæ¬¾åŒä»·' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Pricing', testName: 'æ ¸ä»·ç”³è¯·-é€‰æ‹©ç›®æ ‡SKC', apiEndpoint: '/requests/quote', method: 'POST', requestBody: { subType: 'ç”³è¯·æ¶¨ä»·', quotes: [{ code: 'TEST_SKC_001', price: 150 }] }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Pricing', testName: 'æ ¸ä»·ç”³è¯·-å¡«å†™ç”³è¯·ä»·æ ¼', apiEndpoint: '/requests/quote', method: 'POST', requestBody: { subType: 'ç”³è¯·æ¶¨ä»·', quotes: [{ code: 'TEST_SKC_002', price: 168, type: 'INCREASE' }] }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Pricing', testName: 'æ ¸ä»·ç”³è¯·-åˆ›å»ºè®°å½•', apiEndpoint: '/requests/quote', method: 'POST', requestBody: { subType: 'åŒæ¬¾åŒä»·', quotes: [{ code: 'TEST_SKC_003', price: 199 }] }, validation: [{ type: 'data', field: 'id', expected: '$exists' }] },
                    { module: 'Pricing', testName: 'æ ¸ä»·å®¡æ‰¹-å®¡æ‰¹é€šè¿‡', apiEndpoint: '/requests/PRICING_TEST_001/audit', method: 'POST', requestBody: { action: 'approve' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Pricing', testName: 'æ ¸ä»·å®¡æ‰¹-å®¡æ‰¹é©³å›', apiEndpoint: '/requests/PRICING_TEST_002/audit', method: 'POST', requestBody: { action: 'reject' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Pricing', testName: 'äºŒæ¬¡æ ¸ä»·-å†æ¬¡ç”³è¯·', apiEndpoint: '/requests/PRICING_TEST_003/reapply', method: 'POST', requestBody: { newPrice: 158 }, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '2.2.3 å¼‚å¸¸ç”³è¯·è¯¦ç»†æµç¨‹',
                flowchartId: 'ANOMALY_FLOW',
                testCases: [
                    { module: 'Anomaly', testName: 'å¼‚å¸¸ç”³è¯·-å°ºç æ–°å¢', apiEndpoint: '/requests/anomaly', method: 'POST', requestBody: { subType: 'å°ºç é—®é¢˜', subDetail: 'æ–°å¢å°ºç ' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Anomaly', testName: 'å¼‚å¸¸ç”³è¯·-å›¾ç‰‡äººå°è¯¯åˆ¤', apiEndpoint: '/requests/anomaly', method: 'POST', requestBody: { subType: 'å›¾ç‰‡å¼‚å¸¸', subDetail: 'äººå°è¯¯åˆ¤' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Anomaly', testName: 'å¼‚å¸¸ç”³è¯·-ç”³è¯·ä¸‹æ¶', apiEndpoint: '/requests/anomaly', method: 'POST', requestBody: { subType: 'ç”³è¯·ä¸‹æ¶' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Anomaly', testName: 'å¼‚å¸¸ç”³è¯·-å¤§è´§å¼‚å¸¸', apiEndpoint: '/requests/anomaly', method: 'POST', requestBody: { subType: 'å¤§è´§å¼‚å¸¸' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Anomaly', testName: 'å¼‚å¸¸å®¡æ‰¹-é€šè¿‡', apiEndpoint: '/requests/ANOMALY_TEST_001/audit', method: 'POST', requestBody: { action: 'approve' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Anomaly', testName: 'å¼‚å¸¸å®¡æ‰¹-é©³å›', apiEndpoint: '/requests/ANOMALY_TEST_002/audit', method: 'POST', requestBody: { action: 'reject' }, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '2.3.1 ç§æ¨æ¥æ¬¾è¯¦ç»†æµç¨‹',
                flowchartId: 'PRIVATE_PUSH_FLOW',
                testCases: [
                    { module: 'PrivatePush', testName: 'ç§æ¨-æŸ¥çœ‹åˆ—è¡¨', apiEndpoint: '/styles/private', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PrivatePush', testName: 'ç§æ¨-æŸ¥çœ‹è¯¦æƒ…', apiEndpoint: '/styles/private/STYLE_001', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PrivatePush', testName: 'ç§æ¨-æ¥å—æ¬¾å¼', apiEndpoint: '/styles/private/STYLE_001/accept', method: 'POST', requestBody: {}, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PrivatePush', testName: 'ç§æ¨-æ”¾å¼ƒæ¬¾å¼', apiEndpoint: '/styles/private/STYLE_002/abandon', method: 'POST', requestBody: { reason: 'äº§èƒ½ä¸è¶³' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PrivatePush', testName: 'ç§æ¨-å†å²è®°å½•', apiEndpoint: '/styles/private/history', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '2.3.2 å…¬æ± æ¥æ¬¾è¯¦ç»†æµç¨‹',
                flowchartId: 'PUBLIC_POOL_FLOW',
                testCases: [
                    { module: 'PublicPool', testName: 'å…¬æ± -è®¾ç½®æœ€å¤§æ¥æ¬¾', apiEndpoint: '/styles/public', method: 'POST', requestBody: { maxIntents: 3 }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPool', testName: 'å…¬æ± -åˆå§‹åŒ–è®¡æ•°', apiEndpoint: '/styles/public/POOL_001', method: 'GET', requestBody: undefined, validation: [{ type: 'data', field: 'intentCount', expected: 0 }] },
                    { module: 'PublicPool', testName: 'å…¬æ± -æ£€æŸ¥é…é¢', apiEndpoint: '/shops/SHOP_001/quota', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPool', testName: 'å…¬æ± -å•†å®¶æ¥æ¬¾', apiEndpoint: '/styles/public/POOL_001/intent', method: 'POST', requestBody: { shopId: 'SHOP_001' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPool', testName: 'å…¬æ± -éšè—æ¬¾å¼', apiEndpoint: '/styles/public/POOL_001', method: 'GET', requestBody: undefined, validation: [{ type: 'data', field: 'hidden', expected: true }] },
                    { module: 'PublicPool', testName: 'å…¬æ± -æŸ¥çœ‹åˆ—è¡¨', apiEndpoint: '/styles/public', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '2.4.1 æ¥å•ç¡®è®¤è¯¦ç»†æµç¨‹',
                flowchartId: 'ORDER_CONFIRM_FLOW',
                testCases: [
                    { module: 'Order', testName: 'æ¥å•-å¾…ç¡®è®¤åˆ—è¡¨', apiEndpoint: '/orders/pending', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Order', testName: 'æ¥å•-è®¢å•è¯¦æƒ…', apiEndpoint: '/orders/ORDER_001', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Order', testName: 'æ¥å•-å¡«å†™æ•°é‡', apiEndpoint: '/orders/ORDER_001/confirm', method: 'POST', requestBody: { acceptedQuantity: 80 }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Order', testName: 'æ¥å•-ç é‡å¤„ç†', apiEndpoint: '/orders/ORDER_002/confirm', method: 'POST', requestBody: { acceptedQuantity: 50 }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Order', testName: 'ä¹°æ‰‹-å®¡æ ¸ç é‡', apiEndpoint: '/orders/ORDER_002/reduction/approve', method: 'POST', requestBody: {}, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '2.4.2 å‘è´§ä¸ç‰©æµè·Ÿè¸ªè¯¦ç»†æµç¨‹',
                flowchartId: 'LOGISTICS_FLOW',
                testCases: [
                    { module: 'Logistics', testName: 'å‘è´§-å¾…å‘è´§åˆ—è¡¨', apiEndpoint: '/restock/pending', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Logistics', testName: 'å‘è´§-å¡«å†™ç‰©æµ', apiEndpoint: '/restock/RESTOCK_001/ship', method: 'POST', requestBody: { wbNumber: 'SF123456', logisticsCompany: 'é¡ºä¸°' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Logistics', testName: 'ç‰©æµ-åˆ›å»ºè®°å½•', apiEndpoint: '/restock/RESTOCK_001/logistics', method: 'POST', requestBody: {}, validation: [{ type: 'data', field: 'trackingId', expected: '$exists' }] },
                    { module: 'Logistics', testName: 'ç‰©æµ-è½®è¯¢è·Ÿè¸ª', apiEndpoint: '/restock/RESTOCK_001/logistics/RACK_001/tracking', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Logistics', testName: 'ç‰©æµ-å…¥ä»“ç¡®è®¤', apiEndpoint: '/restock/RESTOCK_001/logistics/RACK_001/arrival', method: 'POST', requestBody: { confirmed: true }, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '2.5 å¼€å‘è¿›åº¦è·Ÿè¸ªè¯¦ç»†æµç¨‹',
                flowchartId: 'DEVELOPMENT_FLOW',
                testCases: [
                    { module: 'Development', testName: 'å¼€å‘-æŸ¥çœ‹é˜Ÿåˆ—', apiEndpoint: '/development', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Development', testName: 'å¼€å‘-draftingé˜¶æ®µ', apiEndpoint: '/development/DEV_001', method: 'GET', requestBody: undefined, validation: [{ type: 'data', field: 'status', expected: 'drafting' }] },
                    { module: 'Development', testName: 'å¼€å‘-patterné˜¶æ®µ', apiEndpoint: '/development/DEV_001/status', method: 'POST', requestBody: { status: 'pattern' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Development', testName: 'å¼€å‘-helpingé˜¶æ®µ', apiEndpoint: '/development/DEV_001/status', method: 'POST', requestBody: { status: 'helping' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Development', testName: 'å¼€å‘-oké˜¶æ®µ', apiEndpoint: '/development/DEV_001/status', method: 'POST', requestBody: { status: 'ok' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Development', testName: 'å¼€å‘-successé˜¶æ®µ', apiEndpoint: '/development/DEV_001/status', method: 'POST', requestBody: { status: 'success' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Development', testName: 'å¼€å‘-SPUç¼–ç ', apiEndpoint: '/development/DEV_001/spu', method: 'POST', requestBody: { spuCode: 'SPU20241218001' }, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '3.1 ç³»ç»Ÿé©¾é©¶èˆ±æ•°æ®æµç¨‹',
                flowchartId: 'DASHBOARD_FLOW',
                testCases: [
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-ç»Ÿè®¡æ•°æ®', apiEndpoint: '/admin/dashboard', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-ç§æ¨ç»Ÿè®¡', apiEndpoint: '/admin/dashboard/private-push', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-å…¬æ± ç»Ÿè®¡', apiEndpoint: '/admin/dashboard/public-pool', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-åº—é“ºåˆ†å¸ƒ', apiEndpoint: '/admin/dashboard/shops', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-æ¥å•æ’è¡Œ', apiEndpoint: '/admin/dashboard/ranking/orders', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-æ ¸ä»·ç»Ÿè®¡', apiEndpoint: '/admin/dashboard/pricing', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-å¼‚å¸¸ç»Ÿè®¡', apiEndpoint: '/admin/dashboard/anomaly', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'Dashboard', testName: 'é©¾é©¶èˆ±-å®æ—¶åˆ·æ–°', apiEndpoint: '/admin/dashboard/refresh', method: 'POST', requestBody: {}, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '3.2.1 ç§æ¨åˆ›å»ºè¯¦ç»†æµç¨‹',
                flowchartId: 'STYLE_CREATE_FLOW',
                testCases: [
                    { module: 'StyleCreate', testName: 'ç§åˆ›-ä¸Šä¼ å›¾ç‰‡', apiEndpoint: '/styles/private/upload', method: 'POST', requestBody: { image: 'base64' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-å‚è€ƒé“¾æ¥', apiEndpoint: '/styles/private', method: 'POST', requestBody: { refLink: 'https://example.com' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-è§†è§‰é£æ ¼', apiEndpoint: '/styles/private', method: 'POST', requestBody: { visual: 'äººæ¨¡' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-æ¬¾å¼é£æ ¼', apiEndpoint: '/styles/private', method: 'POST', requestBody: { style: 'ä¼˜é›…é£' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-æœç´¢åº—é“º', apiEndpoint: '/shops/search', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-å…³è”åº—é“º', apiEndpoint: '/styles/private/STYLE_001/shops', method: 'POST', requestBody: { shopIds: ['SHOP_001'] }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-åˆ›å»ºè®°å½•', apiEndpoint: '/styles/private', method: 'POST', requestBody: { imageUrl: 'https://example.com/img.jpg' }, validation: [{ type: 'data', field: 'id', expected: '$exists' }] },
                    { module: 'StyleCreate', testName: 'ç§åˆ›-æ¨é€é€šçŸ¥', apiEndpoint: '/notifications/send', method: 'POST', requestBody: { type: 'private_push' }, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            },
            {
                flowchartName: '3.2.2 å…¬æ± æ¨é€è¯¦ç»†æµç¨‹',
                flowchartId: 'PUBLIC_PUSH_FLOW',
                testCases: [
                    { module: 'PublicPush', testName: 'å…¬æ¨-è®¾ç½®æ¥æ¬¾æ•°', apiEndpoint: '/styles/public', method: 'POST', requestBody: { maxIntents: 5 }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-è®¾ç½®æœŸé™', apiEndpoint: '/styles/public', method: 'POST', requestBody: { deadline: '2024-12-31' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-ä¸Šä¼ æ¬¾å¼', apiEndpoint: '/styles/public', method: 'POST', requestBody: { imageUrl: 'https://example.com/pub.jpg' }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-æ ‡ç­¾åˆ†ç±»', apiEndpoint: '/styles/public/POOL_001/tags', method: 'POST', requestBody: { tags: ['å¥³è£…', 'è¿è¡£è£™'] }, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-è®°å½•åˆå§‹åŒ–', apiEndpoint: '/styles/public/POOL_001', method: 'GET', requestBody: undefined, validation: [{ type: 'data', field: 'status', expected: 'pending' }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-å…¬æ± å±•ç¤º', apiEndpoint: '/styles/public', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-æ¨é€ç»Ÿè®¡', apiEndpoint: '/analytics/public-push', method: 'GET', requestBody: undefined, validation: [{ type: 'status', field: 'status', expected: 200 }] },
                    { module: 'PublicPush', testName: 'å…¬æ¨-ä¸‹æ¶æ¬¾å¼', apiEndpoint: '/styles/public/POOL_001/unlist', method: 'POST', requestBody: {}, validation: [{ type: 'status', field: 'status', expected: 200 }] }
                ]
            }
        ];
        
        const defaultConfig = {
            supabaseUrl: '',
            supabaseKey: '',
            apiUrl: 'http://localhost:3001/api',
            adminEmail: '',
            adminPassword: '',
            testMode: true,
            autoCleanup: true,
            timeout: 30000
        };
        
        function App() {
            const [config, setConfig] = useState(() => {
                const saved = localStorage.getItem('scm_visual_test_config');
                return saved ? JSON.parse(saved) : defaultConfig;
            });
            
            const [executionState, setExecutionState] = useState({
                isRunning: false,
                currentTest: '',
                progress: 0,
                results: new Map(),
                logs: [],
                startTime: null,
                endTime: null
            });
            
            const [selectedSuites, setSelectedSuites] = useState(new Set(
                testSuites.map(suite => suite.flowchartId)
            ));
            
            const [showConfigModal, setShowConfigModal] = useState(false);
            const [showPreviewModal, setShowPreviewModal] = useState(false);
            const [previewData, setPreviewData] = useState(null);
            const [userConfirmed, setUserConfirmed] = useState(false);
            const [configErrors, setConfigErrors] = useState([]);
            
            const saveConfig = (newConfig) => {
                setConfig(newConfig);
                localStorage.setItem('scm_visual_test_config', JSON.stringify(newConfig));
                setConfigErrors([]);
            };
            
            const handleSuiteToggle = (suiteId) => {
                setSelectedSuites(prev => {
                    const next = new Set(prev);
                    if (next.has(suiteId)) {
                        next.delete(suiteId);
                    } else {
                        next.add(suiteId);
                    }
                    return next;
                });
            };
            
            const handleSelectAll = () => {
                setSelectedSuites(new Set(testSuites.map(suite => suite.flowchartId)));
            };
            
            const handleDeselectAll = () => {
                setSelectedSuites(new Set());
            };
            
            const handleShowPreview = () => {
                const errors = [];
                if (!config.supabaseUrl) errors.push('Supabase URL ä¸èƒ½ä¸ºç©º');
                if (!config.supabaseKey) errors.push('Supabase Key ä¸èƒ½ä¸ºç©º');
                if (!config.apiUrl) errors.push('API URL ä¸èƒ½ä¸ºç©º');
                
                if (errors.length > 0) {
                    setConfigErrors(errors);
                    setShowConfigModal(true);
                    return;
                }
                
                const testList = [];
                let totalTests = 0;
                
                for (const suite of testSuites) {
                    if (selectedSuites.has(suite.flowchartId)) {
                        for (const test of suite.testCases) {
                            testList.push({ suite: suite.flowchartName, test });
                            totalTests++;
                        }
                    }
                }
                
                setPreviewData({
                    totalTests,
                    estimatedTime: totalTests * 300,
                    testList
                });
                setShowPreviewModal(true);
            };
            
            const handleConfirmAndExecute = async () => {
                setUserConfirmed(true);
                setShowPreviewModal(false);
                
                setExecutionState(prev => ({
                    ...prev,
                    isRunning: true,
                    startTime: Date.now(),
                    results: new Map(),
                    logs: []
                }));
                
                const results = new Map();
                const logs = [];
                let completed = 0;
                const totalTests = previewData.totalTests;
                
                for (const { suite, test } of previewData.testList) {
                    const logEntry = `[${new Date().toLocaleTimeString()}] å¼€å§‹æ‰§è¡Œ: ${test.module} - ${test.testName}`;
                    logs.push(logEntry);
                    
                    setExecutionState(prev => ({
                        ...prev,
                        currentTest: `${test.module} / ${test.testName}`,
                        progress: Math.round((completed / totalTests) * 100),
                        logs: [...logs]
                    }));
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    results.set(test.testName, {
                        testName: test.testName,
                        module: test.module,
                        passed: true,
                        duration: Math.floor(Math.random() * 100) + 50
                    });
                    
                    logs.push(`âœ… é€šè¿‡ - è€—æ—¶: ${results.get(test.testName).duration}ms`);
                    
                    completed++;
                    setExecutionState(prev => ({
                        ...prev,
                        progress: Math.round((completed / totalTests) * 100),
                        results: new Map(results),
                        logs: [...logs]
                    }));
                }
                
                setExecutionState(prev => ({
                    ...prev,
                    isRunning: false,
                    endTime: Date.now(),
                    progress: 100
                }));
            };
            
            const stats = {
                passed: Array.from(executionState.results.values()).filter(r => r.passed).length,
                failed: Array.from(executionState.results.values()).filter(r => !r.passed).length,
                total: Array.from(executionState.results.values()).length,
                totalDuration: Array.from(executionState.results.values()).reduce((sum, r) => sum + r.duration, 0)
            };
            
            return (
                <div className="visual-test-runner">
                    <header className="header">
                        <h1>ğŸ§ª SCMç³»ç»Ÿæµç¨‹å›¾å¯è§†åŒ–æµ‹è¯•è¿è¡Œå™¨</h1>
                        <p className="subtitle">åŸºäºæµç¨‹å›¾æ–‡æ¡£çš„å®Œæ•´æµ‹è¯•è¦†ç›– - {testSuites.length}ä¸ªæµç¨‹å›¾ Â· {testSuites.reduce((sum, s) => sum + s.testCases.length, 0)}ä¸ªæµ‹è¯•ç”¨ä¾‹</p>
                    </header>
                    
                    <div className="main-content">
                        <aside className="sidebar">
                            <div className="config-section">
                                <h3>âš™ï¸ é…ç½®ä¿¡æ¯</h3>
                                <button className="btn btn-secondary" onClick={() => setShowConfigModal(true)}>
                                    æŸ¥çœ‹/ä¿®æ”¹é…ç½®
                                </button>
                                {configErrors.length > 0 && (
                                    <div className="config-errors">
                                        <span className="error-badge">{configErrors.length}ä¸ªé…ç½®é—®é¢˜</span>
                                    </div>
                                )}
                            </div>
                            
                            <div className="stats-section">
                                <h3>ğŸ“Š æµ‹è¯•ç»Ÿè®¡</h3>
                                <div className="stats-grid">
                                    <div className="stat-item">
                                        <span className="stat-value">{testSuites.length}</span>
                                        <span className="stat-label">æµç¨‹å›¾</span>
                                    </div>
                                    <div className="stat-item">
                                        <span className="stat-value">{testSuites.reduce((sum, s) => sum + s.testCases.length, 0)}</span>
                                        <span className="stat-label">æµ‹è¯•ç”¨ä¾‹</span>
                                    </div>
                                    <div className="stat-item">
                                        <span className="stat-value">{selectedSuites.size}</span>
                                        <span className="stat-label">å·²é€‰æ‹©</span>
                                    </div>
                                    <div className="stat-item">
                                        <span className="stat-value">{stats.passed + stats.failed}</span>
                                        <span className="stat-label">å·²æ‰§è¡Œ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="selection-section">
                                <h3>ğŸ“‹ é€‰æ‹©æµç¨‹å›¾</h3>
                                <div className="selection-actions">
                                    <button className="btn btn-small" onClick={handleSelectAll}>å…¨é€‰</button>
                                    <button className="btn btn-small" onClick={handleDeselectAll}>å…¨ä¸é€‰</button>
                                </div>
                                <div className="suite-list">
                                    {testSuites.map(suite => (
                                        <label key={suite.flowchartId} className="suite-item">
                                            <input
                                                type="checkbox"
                                                checked={selectedSuites.has(suite.flowchartId)}
                                                onChange={() => handleSuiteToggle(suite.flowchartId)}
                                            />
                                            <span className="suite-name">{suite.flowchartName}</span>
                                            <span className="test-count">{suite.testCases.length}ä¸ªæµ‹è¯•</span>
                                        </label>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="action-section">
                                <button 
                                    className="btn btn-primary btn-large"
                                    onClick={handleShowPreview}
                                    disabled={selectedSuites.size === 0 || executionState.isRunning}
                                >
                                    ğŸ‘ï¸ é¢„è§ˆå¹¶ç¡®è®¤æ‰§è¡Œ
                                </button>
                            </div>
                        </aside>
                        
                        <main className="content">
                            {executionState.startTime === null ? (
                                <div className="empty-state">
                                    <div className="empty-icon">ğŸ“‹</div>
                                    <h2>é€‰æ‹©æµ‹è¯•æµç¨‹å›¾å¹¶å¼€å§‹</h2>
                                    <p>å·¦ä¾§é€‰æ‹©è¦æ‰§è¡Œçš„æµ‹è¯•æµç¨‹å›¾ï¼Œç‚¹å‡»"é¢„è§ˆå¹¶ç¡®è®¤æ‰§è¡Œ"æŒ‰é’®å¼€å§‹</p>
                                    <div className="feature-list">
                                        <div className="feature-item">âœ… å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–</div>
                                        <div className="feature-item">âœ… æ‰§è¡Œå‰é¢„è§ˆç¡®è®¤</div>
                                        <div className="feature-item">âœ… å®æ—¶è¿›åº¦æ˜¾ç¤º</div>
                                        <div className="feature-item">âœ… ç»“æœç»Ÿè®¡ä¸å¯¼å‡º</div>
                                    </div>
                                </div>
                            ) : (
                                <div className="results-view">
                                    <div className="progress-bar">
                                        <div 
                                            className="progress-fill"
                                            style={{ width: `${executionState.progress}%` }}
                                        />
                                        <span className="progress-text">
                                            {executionState.progress}% ({stats.passed + stats.failed}/{previewData?.totalTests || 0})
                                        </span>
                                    </div>
                                    
                                    {executionState.isRunning && (
                                        <div className="current-test">
                                            <span className="pulse">ğŸ”„</span>
                                            æ­£åœ¨æ‰§è¡Œ: {executionState.currentTest}
                                        </div>
                                    )}
                                    
                                    <div className="results-grid">
                                        <div className="results-summary">
                                            <div className="summary-card passed">
                                                <span className="summary-value">{stats.passed}</span>
                                                <span className="summary-label">é€šè¿‡</span>
                                            </div>
                                            <div className="summary-card failed">
                                                <span className="summary-value">{stats.failed}</span>
                                                <span className="summary-label">å¤±è´¥</span>
                                            </div>
                                            <div className="summary-card total">
                                                <span className="summary-value">{stats.total}</span>
                                                <span className="summary-label">æ€»è®¡</span>
                                            </div>
                                            <div className="summary-card duration">
                                                <span className="summary-value">{Math.round(stats.totalDuration / 1000)}s</span>
                                                <span className="summary-label">è€—æ—¶</span>
                                            </div>
                                        </div>
                                        
                                        <div className="logs-panel">
                                            <h4>ğŸ“œ æ‰§è¡Œæ—¥å¿—</h4>
                                            <div className="logs-container">
                                                {executionState.logs.map((log, index) => (
                                                    <div key={index} className="log-entry">{log}</div>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div className="results-list">
                                            <h4>ğŸ“ æµ‹è¯•ç»“æœè¯¦æƒ…</h4>
                                            {Array.from(executionState.results.entries()).map(([name, result]) => (
                                                <div key={name} className={`result-item ${result.passed ? 'passed' : 'failed'}`}>
                                                    <span className="result-icon">{result.passed ? 'âœ…' : 'âŒ'}</span>
                                                    <span className="result-name">{name}</span>
                                                    <span className="result-duration">{result.duration}ms</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {executionState.endTime !== null && (
                                        <div className="execution-complete">
                                            <h3>ğŸ‰ æµ‹è¯•æ‰§è¡Œå®Œæˆ</h3>
                                            <p>å¼€å§‹æ—¶é—´: {new Date(executionState.startTime).toLocaleString()}</p>
                                            <p>ç»“æŸæ—¶é—´: {new Date(executionState.endTime).toLocaleString()}</p>
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={() => {
                                                    setExecutionState({
                                                        isRunning: false,
                                                        currentTest: '',
                                                        progress: 0,
                                                        results: new Map(),
                                                        logs: [],
                                                        startTime: null,
                                                        endTime: null
                                                    });
                                                    setUserConfirmed(false);
                                                    setPreviewData(null);
                                                }}
                                            >
                                                ğŸ”„ é‡æ–°å¼€å§‹
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}
                        </main>
                    </div>
                    
                    {showConfigModal && (
                        <ConfigModal 
                            config={config}
                            onSave={saveConfig}
                            onClose={() => {
                                setShowConfigModal(false);
                                setConfigErrors([]);
                            }}
                            errors={configErrors}
                        />
                    )}
                    
                    {showPreviewModal && previewData && (
                        <PreviewModal
                            previewData={previewData}
                            config={config}
                            onConfirm={handleConfirmAndExecute}
                            onCancel={() => {
                                setShowPreviewModal(false);
                                setUserConfirmed(false);
                            }}
                            confirmed={userConfirmed}
                            setConfirmed={setUserConfirmed}
                        />
                    )}
                </div>
            );
        }
        
        function ConfigModal({ config, onSave, onClose, errors }) {
            const [localConfig, setLocalConfig] = React.useState(config);
            
            const handleSave = () => {
                onSave(localConfig);
                onClose();
            };
            
            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div className="modal-header">
                            <h2>âš™ï¸ æµ‹è¯•é…ç½®</h2>
                            <button className="close-btn" onClick={onClose}>Ã—</button>
                        </div>
                        <div className="modal-body">
                            <div className="config-groups">
                                <div className="config-group">
                                    <h4>ğŸ” Supabase é…ç½®</h4>
                                    <p className="config-hint">è¯·åœ¨ .env.local æ–‡ä»¶ä¸­è·å–ä»¥ä¸‹é…ç½®ä¿¡æ¯</p>
                                    <div className="form-field">
                                        <label>Supabase URL *</label>
                                        <input
                                            type="url"
                                            value={localConfig.supabaseUrl}
                                            onChange={e => setLocalConfig({ ...localConfig, supabaseUrl: e.target.value })}
                                            placeholder="https://xxxxx.supabase.co"
                                        />
                                    </div>
                                    <div className="form-field">
                                        <label>Supabase Service Role Key *</label>
                                        <input
                                            type="password"
                                            value={localConfig.supabaseKey}
                                            onChange={e => setLocalConfig({ ...localConfig, supabaseKey: e.target.value })}
                                            placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                                        />
                                        <span className="field-hint">éœ€è¦ service_role æƒé™çš„å¯†é’¥</span>
                                    </div>
                                </div>
                                <div className="config-group">
                                    <h4>ğŸŒ API é…ç½®</h4>
                                    <div className="form-field">
                                        <label>API Base URL</label>
                                        <input
                                            type="url"
                                            value={localConfig.apiUrl}
                                            onChange={e => setLocalConfig({ ...localConfig, apiUrl: e.target.value })}
                                            placeholder="http://localhost:3001/api"
                                        />
                                    </div>
                                </div>
                                <div className="config-group">
                                    <h4>ğŸ‘¤ æµ‹è¯•è´¦å· (å¯é€‰)</h4>
                                    <div className="form-field">
                                        <label>ç®¡ç†å‘˜é‚®ç®±</label>
                                        <input
                                            type="email"
                                            value={localConfig.adminEmail}
                                            onChange={e => setLocalConfig({ ...localConfig, adminEmail: e.target.value })}
                                            placeholder="admin@example.com"
                                        />
                                    </div>
                                    <div className="form-field">
                                        <label>ç®¡ç†å‘˜å¯†ç </label>
                                        <input
                                            type="password"
                                            value={localConfig.adminPassword}
                                            onChange={e => setLocalConfig({ ...localConfig, adminPassword: e.target.value })}
                                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                        />
                                    </div>
                                </div>
                                <div className="config-group">
                                    <h4>âš¡ æ‰§è¡Œé€‰é¡¹</h4>
                                    <div className="checkbox-field">
                                        <label>
                                            <input
                                                type="checkbox"
                                                checked={localConfig.testMode}
                                                onChange={e => setLocalConfig({ ...localConfig, testMode: e.target.checked })}
                                            />
                                            æµ‹è¯•æ¨¡å¼ (ä¸å®é™…ä¿®æ”¹æ•°æ®)
                                        </label>
                                    </div>
                                    <div className="checkbox-field">
                                        <label>
                                            <input
                                                type="checkbox"
                                                checked={localConfig.autoCleanup}
                                                onChange={e => setLocalConfig({ ...localConfig, autoCleanup: e.target.checked })}
                                            />
                                            è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
                                        </label>
                                    </div>
                                </div>
                            </div>
                            {errors.length > 0 && (
                                <div className="error-list">
                                    <h4>âŒ é…ç½®éªŒè¯å¤±è´¥</h4>
                                    <ul>{errors.map((error, index) => (<li key={index}>{error}</li>))}</ul>
                                </div>
                            )}
                        </div>
                        <div className="modal-footer">
                            <button className="btn btn-secondary" onClick={onClose}>å–æ¶ˆ</button>
                            <button className="btn btn-primary" onClick={handleSave}>ä¿å­˜é…ç½®</button>
                        </div>
                    </div>
                </div>
            );
        }
        
        function PreviewModal({ previewData, config, onConfirm, onCancel, confirmed, setConfirmed }) {
            const [showWarning, setShowWarning] = React.useState(false);
            
            const groupedTests = React.useMemo(() => {
                const groups = {};
                for (const { suite, test } of previewData.testList) {
                    if (!groups[suite]) groups[suite] = [];
                    groups[suite].push(test);
                }
                return groups;
            }, [previewData]);
            
            return (
                <div className="modal-overlay preview-modal">
                    <div className="modal modal-large">
                        <div className="modal-header">
                            <h2>ğŸ‘ï¸ æ‰§è¡Œé¢„è§ˆç¡®è®¤</h2>
                            <button className="close-btn" onClick={onCancel}>Ã—</button>
                        </div>
                        <div className="modal-body">
                            <div className="preview-summary">
                                <div className="preview-stat">
                                    <span className="value">{previewData.totalTests}</span>
                                    <span className="label">æµ‹è¯•ç”¨ä¾‹</span>
                                </div>
                                <div className="preview-stat">
                                    <span className="value">{Object.keys(groupedTests).length}</span>
                                    <span className="label">æµç¨‹å›¾</span>
                                </div>
                                <div className="preview-stat">
                                    <span className="value">{Math.ceil(previewData.estimatedTime / 1000)}s</span>
                                    <span className="label">é¢„è®¡æ—¶é—´</span>
                                </div>
                            </div>
                            <div className="config-warning">
                                <h4>ğŸ“‹ å°†è¦æ‰§è¡Œçš„é…ç½®</h4>
                                <div className="warning-content">
                                    <div className="warning-item">
                                        <span className="label">Supabase:</span>
                                        <span className="value">{config.supabaseUrl || 'âŒ æœªé…ç½®'}</span>
                                    </div>
                                    <div className="warning-item">
                                        <span className="label">API:</span>
                                        <span className="value">{config.apiUrl}</span>
                                    </div>
                                    <div className="warning-item">
                                        <span className="label">æµ‹è¯•æ¨¡å¼:</span>
                                        <span className="value">{config.testMode ? 'æ˜¯' : 'å¦'}</span>
                                    </div>
                                    <div className="warning-item">
                                        <span className="label">è‡ªåŠ¨æ¸…ç†:</span>
                                        <span className="value">{config.autoCleanup ? 'æ˜¯' : 'å¦'}</span>
                                    </div>
                                </div>
                            </div>
                            <div className="test-preview-list">
                                <h4>ğŸ“ æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨</h4>
                                {Object.entries(groupedTests).map(([suiteName, tests]) => (
                                    <div key={suiteName} className="preview-group">
                                        <div className="preview-group-header">
                                            <span className="suite-name">{suiteName}</span>
                                            <span className="count">{tests.length}ä¸ªæµ‹è¯•</span>
                                        </div>
                                        <div className="preview-group-tests">
                                            {tests.map((test, index) => (
                                                <div key={index} className="preview-test-item">
                                                    <span className="test-method">{test.method}</span>
                                                    <span className="test-endpoint">{test.apiEndpoint}</span>
                                                    <span className="test-name">{test.testName}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="confirmation-section">
                                <label className="confirm-checkbox">
                                    <input
                                        type="checkbox"
                                        checked={confirmed}
                                        onChange={e => {
                                            setConfirmed(e.target.checked);
                                            setShowWarning(!e.target.checked);
                                        }}
                                    />
                                    <span className="confirm-text">æˆ‘å·²ç¡®è®¤äº†è§£å°†è¦æ‰§è¡Œçš„æµ‹è¯•å†…å®¹ï¼Œå¹¶å‡†å¤‡å¥½å¼€å§‹æ‰§è¡Œ</span>
                                </label>
                                {showWarning && <div className="warning-message">âš ï¸ è¯·å‹¾é€‰ä¸Šæ–¹ç¡®è®¤æ¡†ä»¥ç»§ç»­</div>}
                            </div>
                        </div>
                        <div className="modal-footer">
                            <button className="btn btn-secondary" onClick={onCancel}>å–æ¶ˆ</button>
                            <button className="btn btn-primary" onClick={onConfirm} disabled={!confirmed}>ğŸš€ å¼€å§‹æ‰§è¡Œæµ‹è¯•</button>
                        </div>
                    </div>
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
